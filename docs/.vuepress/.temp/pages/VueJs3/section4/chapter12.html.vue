<template><div><h1 id="ç»„ä»¶çš„å®ç°åŸç†" tabindex="-1"><a class="header-anchor" href="#ç»„ä»¶çš„å®ç°åŸç†" aria-hidden="true">#</a> ç»„ä»¶çš„å®ç°åŸç†</h1>
<p>æ¸²æŸ“å™¨ä¸»è¦è´Ÿè´£å°†è™šæ‹Ÿ DOM æ¸²æŸ“ä¸ºçœŸå® DOMï¼Œæˆ‘ä»¬åªéœ€è¦ä½¿ç”¨è™šæ‹Ÿ DOM æ¥æè¿°æœ€ç»ˆè¦å‘ˆç°çš„çœŸå® DOM å³å¯ã€‚</p>
<p>ä½†å½“æˆ‘ä»¬ç¼–å†™æ¯”è¾ƒå¤æ‚çš„é¡µé¢æ—¶ï¼Œç”¨æ¥æè¿°é¡µé¢ç»“æ„çš„è™šæ‹Ÿ DOM çš„ä»£ç é‡ä¼šè¶Šæ¥è¶Šå¤šï¼Œæˆ–è€…è¯´é¡µé¢æ¨¡æ¿ä¼šå˜å¾—è¶Šæ¥è¶Šå¤§ã€‚è¿™æ—¶ï¼Œæˆ‘ä»¬å°±éœ€è¦ç»„ä»¶åŒ–çš„èƒ½åŠ›ã€‚</p>
<p>æœ‰äº†ç»„ä»¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥å°†ä¸€ä¸ªå¤§çš„é¡µé¢æ‹†åˆ†ä¸ºå¤šä¸ªéƒ¨åˆ†ï¼Œæ¯ä¸ªéƒ¨åˆ†éƒ½å¯ä»¥ä½œä¸ºå•ç‹¬çš„ç»„ä»¶ï¼Œè¿™äº›ç»„ä»¶å…±åŒç»„æˆå®Œæ•´çš„é¡µé¢ã€‚ç»„ä»¶åŒ–çš„å®ç°åŒæ ·éœ€è¦æ¸²æŸ“å™¨çš„æ”¯æŒã€‚</p>
<h2 id="æ¸²æŸ“ç»„ä»¶" tabindex="-1"><a class="header-anchor" href="#æ¸²æŸ“ç»„ä»¶" aria-hidden="true">#</a> æ¸²æŸ“ç»„ä»¶</h2>
<blockquote>
<ul>
<li>ä½¿ç”¨è™šæ‹ŸèŠ‚ç‚¹çš„ <code v-pre>vnode.type</code> å±æ€§æ¥å­˜å‚¨ç»„ä»¶å¯¹è±¡ï¼Œæ¸²æŸ“å™¨æ ¹æ®è™šæ‹ŸèŠ‚ç‚¹çš„è¯¥å±æ€§çš„ç±»å‹æ¥åˆ¤æ–­å®ƒæ˜¯å¦æ˜¯ç»„ä»¶ã€‚</li>
<li>å¦‚æœæ˜¯ç»„ä»¶ï¼Œåˆ™æ¸²æŸ“å™¨ä¼šè°ƒç”¨ <code v-pre>mountComponent</code> å’Œ <code v-pre>patchComponent</code> æ¥å®Œæˆç»„ä»¶çš„æŒ‚è½½å’Œæ›´æ–°ã€‚</li>
</ul>
</blockquote>
<h3 id="ç»„ä»¶ç±»å‹èŠ‚ç‚¹" tabindex="-1"><a class="header-anchor" href="#ç»„ä»¶ç±»å‹èŠ‚ç‚¹" aria-hidden="true">#</a> ç»„ä»¶ç±»å‹èŠ‚ç‚¹</h3>
<p>ä»<strong>ç”¨æˆ·è§’åº¦</strong>æ¥çœ‹ï¼Œä¸€ä¸ª<strong>æœ‰çŠ¶æ€ç»„ä»¶</strong>å°±æ˜¯ä¸€ä¸ª<strong>é€‰é¡¹å¯¹è±¡</strong>ï¼Œå¦‚ä¸‹é¢çš„ä»£ç æ‰€ç¤ºï¼š</p>
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code><span class="token comment">// MyComponent æ˜¯ä¸€ä¸ªç»„ä»¶ï¼Œå®ƒçš„å€¼æ˜¯ä¸€ä¸ªé€‰é¡¹å¯¹è±¡</span>
<span class="token keyword">const</span> MyComponent <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'MyComponent'</span><span class="token punctuation">,</span>
    <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token literal-property property">foo</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä»<strong>æ¸²æŸ“å™¨è§’åº¦</strong>æ¥çœ‹ï¼Œä¸€ä¸ªç»„ä»¶åˆ™æ˜¯ä¸€ä¸ªç‰¹æ®Šç±»å‹çš„è™šæ‹Ÿ DOM èŠ‚ç‚¹ï¼š</p>
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code><span class="token keyword">const</span> vnode <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token comment">// 'div' | Fragemnt | Text...</span>
	<span class="token literal-property property">type</span><span class="token operator">:</span> MyComponent<span class="token punctuation">,</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre><div class="highlight-lines"><br><br><div class="highlight-line">&nbsp;</div><br><br></div><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="æ¸²æŸ“å™¨å¤„ç†ç»„ä»¶" tabindex="-1"><a class="header-anchor" href="#æ¸²æŸ“å™¨å¤„ç†ç»„ä»¶" aria-hidden="true">#</a> æ¸²æŸ“å™¨å¤„ç†ç»„ä»¶</h3>
<p><strong>æ¸²æŸ“å™¨</strong>ä¼šä½¿ç”¨è™šæ‹ŸèŠ‚ç‚¹çš„ type å±æ€§æ¥åŒºåˆ†å…¶ç±»å‹ã€‚å¯¹äºä¸åŒçš„èŠ‚ç‚¹ï¼Œå°±éœ€è¦é‡‡ç”¨ä¸åŒçš„å¤„ç†æ–¹æ³•æ¥å®ŒæˆæŒ‚è½½å’Œæ›´æ–°ã€‚</p>
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">patch</span><span class="token punctuation">(</span><span class="token parameter">n1<span class="token punctuation">,</span> n2<span class="token punctuation">,</span> container<span class="token punctuation">,</span> anchor</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>n1 <span class="token operator">&amp;&amp;</span> n1<span class="token punctuation">.</span>type <span class="token operator">!==</span> n2<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">unmount</span><span class="token punctuation">(</span>n1<span class="token punctuation">)</span>
        n1 <span class="token operator">=</span> <span class="token keyword">null</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">const</span> <span class="token punctuation">{</span> type <span class="token punctuation">}</span> <span class="token operator">=</span> n2
    
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> type <span class="token operator">===</span> <span class="token string">'string'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// ä½œä¸ºæ™®é€šå…ƒç´ å¤„ç†</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> Text<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// ä½œä¸ºæ–‡æœ¬èŠ‚ç‚¹å¤„ç†</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> Fragment<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// ä½œä¸ºç‰‡æ®µå¤„ç†</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> type <span class="token operator">===</span> <span class="token string">'object'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// component</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>n1<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">mountComponent</span><span class="token punctuation">(</span>n2<span class="token punctuation">,</span> container<span class="token punctuation">,</span> anchor<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token function">patchComponent</span><span class="token punctuation">(</span>n1<span class="token punctuation">,</span> n2<span class="token punctuation">,</span> anchor<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlight-line">&nbsp;</div><div class="highlight-line">&nbsp;</div><div class="highlight-line">&nbsp;</div><div class="highlight-line">&nbsp;</div><div class="highlight-line">&nbsp;</div><div class="highlight-line">&nbsp;</div><div class="highlight-line">&nbsp;</div><br></div><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é€šè¿‡åœ¨ patch å‡½æ•°ä¸­å¯¹ç»„ä»¶ç±»å‹é€»è¾‘åˆ†æ”¯çš„è¡¥å……ï¼Œæ¸²æŸ“å™¨å› æ­¤æœ‰äº†å¤„ç†ç»„ä»¶çš„èƒ½åŠ›ã€‚</p>
<h3 id="ç»„ä»¶æ¥å£è®¾è®¡" tabindex="-1"><a class="header-anchor" href="#ç»„ä»¶æ¥å£è®¾è®¡" aria-hidden="true">#</a> ç»„ä»¶æ¥å£è®¾è®¡</h3>
<div class="custom-container tip"><p class="custom-container-title">æ¥ä¸‹æ¥ï¼Œè¦è®¾è®¡ç»„ä»¶åœ¨ç”¨æˆ·å±‚é¢çš„æ¥å£</p>
<ol>
<li>ç”¨æˆ·åº”è¯¥å¦‚ä½•ç¼–å†™ç»„ä»¶ï¼Ÿ</li>
<li>ç»„ä»¶çš„é€‰é¡¹å¯¹è±¡å¿…é¡»åŒ…å«å“ªäº›å†…å®¹ï¼Ÿ</li>
<li>ç»„ä»¶æ‹¥æœ‰å“ªäº›èƒ½åŠ›ï¼Ÿ</li>
</ol>
</div>
<p>ğŸš€ ç»„ä»¶æœ¬èº«æ˜¯å¯¹é¡µé¢å†…å®¹çš„å°è£…ï¼Œå®ƒç”¨æ¥æè¿°é¡µé¢å†…å®¹çš„ä¸€éƒ¨åˆ†ã€‚å› æ­¤ï¼Œä¸€ä¸ªç»„ä»¶<strong>å¿…é¡»åŒ…å«ä¸€ä¸ªæ¸²æŸ“å‡½æ•°</strong>ï¼Œå³ render å‡½æ•°ï¼Œå¹¶ä¸”æ¸²æŸ“å‡½æ•°çš„è¿”å›å€¼åº”è¯¥æ˜¯è™šæ‹Ÿ DOMã€‚</p>
<p>æ¢å¥è¯è¯´ï¼Œ<strong>ç»„ä»¶çš„æ¸²æŸ“å‡½æ•°å°±æ˜¯ç”¨æ¥æè¿°ç»„ä»¶æ‰€æ¸²æŸ“å†…å®¹çš„æ¥å£</strong>ã€‚</p>
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code><span class="token comment">// vnode.type</span>
<span class="token keyword">const</span> MyComponent <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'MyComponent'</span><span class="token punctuation">,</span>
    <span class="token comment">// ç»„ä»¶çš„æ¸²æŸ“å‡½æ•°ï¼Œå…¶è¿”å›å€¼å¿…é¡»ä¸ºè™šæ‹Ÿ DOM</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'div'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token string">'æˆ‘æ˜¯æ–‡æœ¬'</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ˜¯ä¸€ä¸ªç®€å•çš„ç»„ä»¶å®ä¾‹ã€‚æœ‰äº†åŸºæœ¬çš„ç»„ä»¶ç»“æ„ä¹‹åï¼Œæ¸²æŸ“å™¨å°±å¯ä»¥å®Œæˆç»„ä»¶çš„æ¸²æŸ“ï¼š</p>
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code><span class="token comment">// ç»„ä»¶ç±»å‹çš„ VNode</span>
<span class="token keyword">const</span> CompVNode <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> MyComponent<span class="token punctuation">,</span>  <span class="token comment">// ä¸Šé¢å£°æ˜çš„ç»„ä»¶å¯¹è±¡</span>
<span class="token punctuation">}</span>
<span class="token comment">// è°ƒç”¨æ¸²æŸ“å™¨æ¥æ¸²æŸ“ç»„ä»¶</span>
renderer<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>CompVNode<span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ¸²æŸ“å™¨ä¸­çœŸæ­£å®Œæˆç»„ä»¶æ¸²æŸ“çš„æ˜¯ mountComponent å‡½æ•°ï¼Œå…¶å…·ä½“å®ç°å¦‚ä¸‹ï¼š</p>
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">mountComponent</span><span class="token punctuation">(</span><span class="token parameter">vnode<span class="token punctuation">,</span> container<span class="token punctuation">,</span> anchor</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// é€šè¿‡ vnode è·å–ç»„ä»¶çš„é€‰é¡¹å¯¹è±¡ï¼Œå³ vnode.type</span>
    <span class="token keyword">const</span> componentOptions <span class="token operator">=</span> vnode<span class="token punctuation">.</span>type
    <span class="token comment">// è·å–ç»„ä»¶çš„ render å‡½æ•°</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> render <span class="token punctuation">}</span> <span class="token operator">=</span> componentOptions
    <span class="token comment">// æ‰§è¡Œ renderå‡½æ•°ï¼Œå¾—åˆ°ç»„ä»¶è¦æ¸²æŸ“å†…å®¹çš„è™šæ‹Ÿ DOM</span>
    <span class="token keyword">const</span> subTree <span class="token operator">=</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// æŒ‚è½½ç»„ä»¶å†…å®¹åˆ°çˆ¶èŠ‚ç‚¹</span>
    <span class="token function">patch</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> subTree<span class="token punctuation">,</span> container<span class="token punctuation">,</span> anchor<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ ·ï¼Œæˆ‘ä»¬å°±å®ç°äº†æœ€åŸºæœ¬çš„ç»„ä»¶åŒ–æ–¹æ¡ˆã€‚</p>
<h2 id="ç»„ä»¶çŠ¶æ€ä¸è‡ªæ›´æ–°" tabindex="-1"><a class="header-anchor" href="#ç»„ä»¶çŠ¶æ€ä¸è‡ªæ›´æ–°" aria-hidden="true">#</a> ç»„ä»¶çŠ¶æ€ä¸è‡ªæ›´æ–°</h2>
<blockquote>
<ul>
<li>åœ¨ç»„ä»¶çš„æŒ‚è½½é˜¶æ®µï¼Œä¼šä¸ºç»„ä»¶åˆ›å»ºä¸€ä¸ªç”¨äºæ¸²æŸ“å…¶å†…å®¹çš„å‰¯ä½œç”¨å‡½æ•°ã€‚è¯¥å‰¯ä½œç”¨å‡½æ•°ä¼šä¸ç»„ä»¶è‡ªèº«çš„å“åº”å¼æ•°æ®å»ºç«‹å“åº”è”ç³»ã€‚å½“ç»„ä»¶è‡ªèº«çš„å“åº”å¼æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶ï¼Œä¼šè§¦å‘æ¸²æŸ“å‰¯ä½œç”¨å‡½æ•°é‡æ–°æ‰§è¡Œï¼Œå³é‡æ–°æ¸²æŸ“ã€‚</li>
<li>é»˜è®¤æƒ…å†µä¸‹é‡æ–°æ¸²æŸ“æ˜¯é‡æ–°æ‰§è¡Œçš„ï¼Œè¿™å¯¼è‡´æ— æ³•å»é‡ï¼Œå› æ­¤æˆ‘ä»¬åœ¨åˆ›å»ºæ¸²æŸ“å‰¯ä½œç”¨å‡½æ•°æ—¶ï¼Œåˆ¶å®šäº†ä¸€ä¸ªè‡ªå®šä¹‰çš„è°ƒç”¨å™¨ã€‚è¯¥è°ƒåº¦å™¨çš„ä½œç”¨æ˜¯ï¼šå½“ç»„ä»¶è‡ªèº«çš„å“åº”å¼æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå°†æ¸²æŸ“å‰¯ä½œç”¨å‡½æ•°ç¼“å†²åˆ°å¾®ä»»åŠ¡é˜Ÿåˆ—ä¸­ã€‚</li>
<li>æœ‰äº†ç¼“å†²é˜Ÿåˆ—ï¼Œæˆ‘ä»¬å³å¯å®ç°å¯¹æ¸²æŸ“ä»»åŠ¡çš„å»é‡ï¼Œä»è€Œé¿å…æ— ç”¨çš„é‡æ–°æ¸²æŸ“æ‰€å¯¼è‡´çš„é¢å¤–æ€§èƒ½å¼€é”€ã€‚</li>
</ul>
</blockquote>
<h3 id="ç»„ä»¶çŠ¶æ€è®¾è®¡" tabindex="-1"><a class="header-anchor" href="#ç»„ä»¶çŠ¶æ€è®¾è®¡" aria-hidden="true">#</a> ç»„ä»¶çŠ¶æ€è®¾è®¡</h3>
<p>ä¸ºç»„ä»¶è®¾è®¡è‡ªèº«çš„çŠ¶æ€ï¼šä¸ºç»„ä»¶å¯¹è±¡è¡¥å……ä¸€ä¸ª data å‡½æ•°ï¼Œå°†å…¶è¿”å›å€¼ä½œä¸ºç»„ä»¶çš„çŠ¶æ€</p>
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code><span class="token keyword">const</span> MyComponent <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'MyComponent'</span><span class="token punctuation">,</span>
    <span class="token comment">// ç”¨ data å‡½æ•°æ¥å®šä¹‰ç»„ä»¶è‡ªèº«çš„çŠ¶æ€</span>
    <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">foo</span><span class="token operator">:</span> <span class="token string">'hello world'</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'div'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">foo çš„å€¼æ˜¯ï¼š </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>foo<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>  <span class="token comment">// åœ¨renderå‡½æ•°ä¸­ä½¿ç”¨ç»„ä»¶çŠ¶æ€</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ğŸ“ ä»¥ä¸Šä»£ç çº¦å®šç”¨æˆ·å¿…é¡»ä½¿ç”¨ data å‡½æ•°æ¥å®šä¹‰ç»„ä»¶è‡ªèº«çš„çŠ¶æ€ï¼ŒåŒæ—¶å¯ä»¥åœ¨æ¸²æŸ“å‡½æ•°ä¸­é€šè¿‡ this è®¿é—®ç”± data å‡½æ•°è¿”å›çš„çŠ¶æ€æ•°æ®ã€‚</p>
<p>ä¸‹é¢ä»£ç å®ç°äº†ç»„ä»¶è‡ªèº«<strong>çŠ¶æ€çš„åˆå§‹åŒ–</strong>ï¼š</p>
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">mountComponent</span><span class="token punctuation">(</span><span class="token parameter">vnode<span class="token punctuation">,</span> container<span class="token punctuation">,</span> anchor</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> componentOptions <span class="token operator">=</span> vnode<span class="token punctuation">.</span>type
    <span class="token keyword">const</span> <span class="token punctuation">{</span> render<span class="token punctuation">,</span> data <span class="token punctuation">}</span> <span class="token operator">=</span> componentOptions
    
    <span class="token comment">// è°ƒç”¨ data å‡½æ•°è·å¾—ç»„ä»¶çŠ¶æ€ï¼Œå¹¶å°†å…¶åŒ…è£…ä¸ºå“åº”å¼æ•°æ®</span>
    <span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment">// å°† render å‡½æ•°çš„ this è®¾ç½®ä¸ºç»„å°†çŠ¶æ€å¯¹è±¡</span>
	<span class="token keyword">const</span> subTree <span class="token operator">=</span> <span class="token function">render</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span> state<span class="token punctuation">)</span>
    <span class="token function">patch</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> subTree<span class="token punctuation">,</span> container<span class="token punctuation">,</span> anchor<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><details class="custom-container details"><summary>å®ç°ç»„ä»¶è‡ªèº«çŠ¶æ€çš„åˆå§‹åŒ–</summary>
<ol>
<li>é€šè¿‡ç»„ä»¶çš„é€‰é¡¹å¯¹è±¡å–å¾— data å‡½æ•°å¹¶æ‰§è¡Œï¼Œç„¶åè°ƒç”¨ reactive å‡½æ•°å°† data å‡½æ•°è¿”å›çš„çŠ¶æ€åŒ…è£…ä¸ºå“åº”å¼æ•°æ®ï¼›</li>
<li>åœ¨è°ƒç”¨ render å‡½æ•°æ—¶ï¼Œå°†å…¶ this çš„æŒ‡å‘è®¾ç½®ä¸ºå“åº”å¼æ•°æ® stateï¼ŒåŒæ—¶å°† state  ä½œä¸º render å‡½æ•°è°ƒç”¨çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¼ é€’ã€‚</li>
</ol>
</details>
<p>âœ… ç»è¿‡è¿™ä¸¤ä¸ªæ­¥éª¤ä¹‹åï¼Œæˆ‘ä»¬å°±å®ç°äº†å¯¹ç»„ä»¶è‡ªèº«<strong>çŠ¶æ€</strong>çš„æ”¯æŒï¼Œä»¥åŠåœ¨æ¸²æŸ“å‡½æ•°å†…<strong>è®¿é—®</strong>ç»„ä»¶è‡ªèº«çŠ¶æ€çš„èƒ½åŠ›ã€‚</p>
<h3 id="ç»„ä»¶çš„è‡ªæ›´æ–°" tabindex="-1"><a class="header-anchor" href="#ç»„ä»¶çš„è‡ªæ›´æ–°" aria-hidden="true">#</a> ç»„ä»¶çš„è‡ªæ›´æ–°</h3>
<p>å½“ç»„ä»¶çŠ¶æ€å‘ç”Ÿå˜åŒ–çš„æ—¶å€™ï¼Œæˆ‘ä»¬è¿˜éœ€è¦æœ‰èƒ½åŠ›è§¦å‘ç»„ä»¶æ›´æ–°ï¼Œå³ç»„ä»¶çš„è‡ªæ›´æ–°ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦æŠŠæ•´ä¸ªæ¸²æŸ“ä»»åŠ¡åŒ…è£…åˆ°ä¸€ä¸ª effect ä¸­ï¼š</p>
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">mountComponent</span><span class="token punctuation">(</span><span class="token parameter">vnode<span class="token punctuation">,</span> container<span class="token punctuation">,</span> anchor</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> componentOptions <span class="token operator">=</span> vnode<span class="token punctuation">.</span>type
    <span class="token keyword">const</span> <span class="token punctuation">{</span> render<span class="token punctuation">,</span> data <span class="token punctuation">}</span> <span class="token operator">=</span> componentOptions

    <span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token function">effect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token punctuation">{</span>
        <span class="token keyword">const</span> subTree <span class="token operator">=</span> <span class="token function">render</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span> state<span class="token punctuation">)</span>
        <span class="token function">patch</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> subTree<span class="token punctuation">,</span> container<span class="token punctuation">,</span> anchor<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ ·ï¼Œæ•°æ®ä¸€æ—¦å˜åŒ–ï¼Œé‚£ä¹ˆæ¸²æŸ“ä»»åŠ¡ä¾¿ä¼šè‡ªåŠ¨æ‰§è¡Œã€‚ä½†æ˜¯ï¼Œå¦‚æœå¤šæ¬¡æ”¹å˜å“åº”å¼æ•°æ®çš„å€¼ï¼Œä¼šå¯¼è‡´æ¸²æŸ“å‡½æ•°æ‰§è¡Œå¤šæ¬¡ï¼Œè¿™å®é™…ä¸Šæ˜¯æ²¡æœ‰å¿…è¦çš„ã€‚</p>
<p>æˆ‘ä»¬éœ€è¦ä¸€ä¸ªæœºåˆ¶æ˜¯çš„æ— è®ºå“åº”å¼æ•°æ®è¿›è¡Œå¤šå°‘æ¬¡ä¿®æ”¹ï¼Œå‰¯ä½œç”¨å‡½æ•°éƒ½åªä¼šæ‰§è¡Œä¸€æ¬¡ã€‚è¿™ä¸ªå€ŸåŠ©ä¹‹å‰çš„<strong>è°ƒåº¦å™¨</strong>å³å¯å®ç°ï¼š</p>
<p>ğŸŒ <a href="https://www.ijerrychen.com/VueJs3/section2/chapter4.html#%E8%B0%83%E5%BA%A6%E6%89%A7%E8%A1%8C" target="_blank" rel="noopener noreferrer">è°ƒåº¦å™¨ (opens new window)<ExternalLinkIcon/></a></p>
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code><span class="token comment">// ä»»åŠ¡ç¼“å­˜é˜Ÿåˆ—ï¼ŒSet å¯è‡ªåŠ¨å»é‡</span>
<span class="token keyword">const</span> queue <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// ä¸€ä¸ªæ ‡å¿—ï¼Œä»£è¡¨æ˜¯å¦æ­£åœ¨åˆ·æ–°ä»»åŠ¡é˜Ÿåˆ—</span>
<span class="token keyword">let</span> isFlushing <span class="token operator">=</span> <span class="token boolean">false</span>
<span class="token comment">// åˆ›å»ºä¸€ä¸ªç«‹å³ resolve çš„ Promise å®ä¾‹</span>
<span class="token keyword">const</span> p <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// è°ƒåº¦å™¨çš„ä¸»è¦å‡½æ•°ï¼Œç”¨æ¥å°†ä¸€ä¸ªä»»åŠ¡æ·»åŠ åˆ°ç¼“å†²é˜Ÿåˆ—ä¸­ï¼Œå¹¶å¼€å§‹åˆ·æ–°é˜Ÿåˆ—</span>
<span class="token keyword">function</span> <span class="token function">queueJob</span><span class="token punctuation">(</span><span class="token parameter">job</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// å°† job æ·»åŠ åˆ°ä»»åŠ¡é˜Ÿåˆ— queue ä¸­</span>
    queue<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>job<span class="token punctuation">)</span>
    <span class="token comment">// å¦‚æœè¿˜æ²¡æœ‰å¼€å§‹åˆ·æ–°é˜Ÿåˆ—ï¼Œåˆ™åˆ·æ–°ä¹‹</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>isFlushing<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// å°†è¯¥æ ‡å¿—è®¾ç½®ä¸º true ä»¥é¿å…é‡å¤åˆ·æ–°</span>
       isFlushing <span class="token operator">=</span> <span class="token boolean">true</span>
        <span class="token comment">// åœ¨è¯¥ä»»åŠ¡é˜Ÿåˆ—ä¸­åˆ·æ–°ä»»åŠ¡</span>
        p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token comment">// æ‰§è¡Œä»»åŠ¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡</span>
                queue<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">job</span> <span class="token operator">=></span> <span class="token function">job</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
                <span class="token comment">// é‡ç½®ä»»åŠ¡</span>
                isFlushing <span class="token operator">=</span> <span class="token boolean">false</span>
                queue<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šé¢ä¸ºè°ƒåº¦å™¨çš„æœ€å°å®ç°ï¼Œæœ¬è´¨ä¸Šåˆ©ç”¨äº†<strong>å¾®ä»»åŠ¡çš„å¼‚æ­¥æ‰§è¡Œæœºåˆ¶</strong>ï¼Œå®ç°å¯¹å‰¯ä½œç”¨å‡½æ•°çš„ç¼“å†²ã€‚æœ‰äº†è°ƒåº¦å™¨å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨åˆ›å»ºæ¸²æŸ“å‰¯ä½œç”¨æ—¶ä½¿ç”¨å®ƒï¼š</p>
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">mountComponent</span><span class="token punctuation">(</span><span class="token parameter">vnode<span class="token punctuation">,</span> container<span class="token punctuation">,</span> anchor</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> componentOptions <span class="token operator">=</span> vnode<span class="token punctuation">.</span>type
    <span class="token keyword">const</span> <span class="token punctuation">{</span> render<span class="token punctuation">,</span> data <span class="token punctuation">}</span> <span class="token operator">=</span> componentOptions

    <span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token function">effect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token punctuation">{</span>
        <span class="token keyword">const</span> subTree <span class="token operator">=</span> <span class="token function">render</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span> state<span class="token punctuation">)</span>
        <span class="token function">patch</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> subTree<span class="token punctuation">,</span> container<span class="token punctuation">,</span> anchor<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token comment">// æŒ‡å®šè¯¥å‰¯ä½œç”¨å‡½æ•°çš„è°ƒåº¦å™¨</span>
        <span class="token literal-property property">scheduler</span><span class="token operator">:</span> queueJob
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><div class="highlight-line">&nbsp;</div><br><br></div><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>âœ… è¿™æ ·ï¼Œå½“å“åº”å¼æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå‰¯ä½œç”¨å‡½æ•°ä¸ä¼šç«‹å³æ‰§è¡Œï¼Œè€Œæ˜¯ä¼šè¢« queueJob å‡½æ•°è°ƒåº¦ï¼Œæœ€ååœ¨ä¸€ä¸ªå¾®ä»»åŠ¡ä¸­æ‰§è¡Œã€‚</p>
<p>ç›®å‰ï¼Œpatch çš„ç¬¬ä¸€ä¸ªå‚æ•°æ€»æ˜¯ nullï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬æ¯æ¬¡æ¸²æŸ“éƒ½æ˜¯å…¨æ–°çš„æŒ‚è½½ï¼Œè€Œä¸ä¼šæ‰“è¡¥ä¸ã€‚æˆ‘ä»¬éœ€è¦å¯¹æ­¤è¿›è¡Œå¤„ç†ï¼Œæ›´æ–°æ—¶å¯ä»¥è¿›è¡Œæ‰“è¡¥ä¸ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦å®ç°ç»„ä»¶å®ä¾‹ï¼Œç”¨å®ƒæ¥ç»´æŠ¤ç»„ä»¶æ•´ä¸ªç”Ÿå‘½å‘¨æœŸçš„çŠ¶æ€ï¼Œè¿™æ ·æ¸²æŸ“å™¨æ‰èƒ½å¤Ÿåœ¨æ­£ç¡®çš„æ—¶æœºæ‰§è¡Œåˆé€‚çš„æ“ä½œã€‚</p>
<h2 id="ç»„ä»¶çš„å®ä¾‹ä¸ç”Ÿå‘½å‘¨æœŸ" tabindex="-1"><a class="header-anchor" href="#ç»„ä»¶çš„å®ä¾‹ä¸ç”Ÿå‘½å‘¨æœŸ" aria-hidden="true">#</a> ç»„ä»¶çš„å®ä¾‹ä¸ç”Ÿå‘½å‘¨æœŸ</h2>
<blockquote>
<ul>
<li>ç»„ä»¶å®ä¾‹æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…å«äº†ç»„ä»¶è¿è¡Œè¿‡ç¨‹ä¸­çš„çŠ¶æ€ï¼ˆç»„ä»¶æ˜¯å¦æŒ‚è½½ã€ç»„ä»¶è‡ªèº«çš„å“åº”å¼æ•°æ®ï¼Œä»¥åŠç»„ä»¶æ‰€æ¸²æŸ“çš„å†…å®¹ <code v-pre>subTree</code> ç­‰ç­‰ï¼‰ã€‚</li>
<li>æ¸²æŸ“å‰¯ä½œç”¨å‡½æ•°å¯ä»¥æ ¹æ®ç»„ä»¶å®ä¾‹çš„çŠ¶æ€æ ‡è¯†æ¥å†³å®šæ˜¯å¦åº”è¯¥è¿›è¡Œæƒé™çš„æŒ‚è½½ï¼Œè¿˜æ˜¯åº”è¯¥æ‰“è¡¥ä¸ã€‚</li>
</ul>
</blockquote>
<h3 id="ç»„ä»¶å®ä¾‹" tabindex="-1"><a class="header-anchor" href="#ç»„ä»¶å®ä¾‹" aria-hidden="true">#</a> ç»„ä»¶å®ä¾‹</h3>
<p>ç»„ä»¶å®ä¾‹æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªçŠ¶æ€é›†åˆï¼ˆæˆ–ä¸€ä¸ªå¯¹è±¡ï¼‰ï¼Œå®ƒç»´æŠ¤ç€ç»„ä»¶è¿è¡Œè¿‡ç¨‹ä¸­çš„æ‰€æœ‰ä¿¡æ¯ï¼Œä¾‹å¦‚æ³¨å†Œåˆ°ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°ã€ç»„ä»¶æ¸²æŸ“çš„å­æ ‘ï¼ˆsubTreeï¼‰ã€ç»„ä»¶æ˜¯å¦å·²ç»æŒ‚è½½ã€ç»„ä»¶è‡ªèº«çš„çŠ¶æ€ï¼ˆdataï¼‰ç­‰ç­‰ã€‚ä¸ºäº†è§£å†³ç›®å‰ç»„ä»¶æ›´æ–°çš„é—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦å¼•å…¥ç»„ä»¶å®ä¾‹çš„æ¦‚å¿µï¼Œä»¥åŠä¸ä¹‹ç›¸å…³çš„çŠ¶æ€ä¿¡æ¯ï¼š</p>
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">mountComponent</span><span class="token punctuation">(</span><span class="token parameter">vnode<span class="token punctuation">,</span> container<span class="token punctuation">,</span> anchor</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> componentOptions <span class="token operator">=</span> vnode<span class="token punctuation">.</span>type
    <span class="token keyword">let</span> <span class="token punctuation">{</span> render<span class="token punctuation">,</span> data <span class="token punctuation">}</span> <span class="token operator">=</span> componentOptions

    <span class="token keyword">const</span> state <span class="token operator">=</span> data <span class="token operator">?</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment">// å®šä¹‰ç»„ä»¶å®ä¾‹ï¼Œä¸€ä¸ªåŒ…å«ç€ç»„ä»¶çŠ¶æ€ä¿¡æ¯çš„å¯¹è±¡</span>
    <span class="token keyword">const</span> instance <span class="token operator">=</span> <span class="token punctuation">{</span>
        state<span class="token punctuation">,</span>  <span class="token comment">// ç»„ä»¶è‡ªèº«çŠ¶æ€æ•°æ®ï¼Œå³ data</span>
        <span class="token literal-property property">isMounted</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>  <span class="token comment">// ç»„ä»¶æ˜¯å¦å·²ç»æŒ‚è½½</span>
        <span class="token literal-property property">subTree</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>  <span class="token comment">// ç»„ä»¶æ‰€æ¸²æŸ“çš„å†…å®¹ï¼Œå³å­æ ‘ï¼ˆsubTreeï¼‰</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// å°†ç»„ä»¶å®ä¾‹è®¾ç½®åˆ° vnode ä¸Šï¼Œç”¨äºåç»­æ›´æ–°</span>
    vnode<span class="token punctuation">.</span>component <span class="token operator">=</span> instance

    <span class="token function">effect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
        <span class="token comment">// è°ƒç”¨ç»„ä»¶çš„æ¸²æŸ“å‡½æ•°ï¼Œè·å¾—è¦æ¸²æŸ“çš„å†…å®¹</span>
        <span class="token keyword">const</span> subTree <span class="token operator">=</span> <span class="token function">render</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span> state<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>instance<span class="token punctuation">.</span>isMounted<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// åˆæ¬¡æŒ‚è½½</span>
            <span class="token function">patch</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> subTree<span class="token punctuation">,</span> container<span class="token punctuation">,</span> anchor<span class="token punctuation">)</span> 
            instance<span class="token punctuation">.</span>isMounted <span class="token operator">=</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>  <span class="token comment">// æ›´æ–° => æ‰“è¡¥ä¸</span>
            <span class="token function">patch</span><span class="token punctuation">(</span>instance<span class="token punctuation">.</span>subTree<span class="token punctuation">,</span> subTree<span class="token punctuation">,</span> container<span class="token punctuation">,</span> anchor<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// æ›´æ–°ç»„ä»¶å®ä¾‹çš„å­æ ‘ï¼Œæ–¹ä¾¿åç»­æ‰“è¡¥ä¸çš„æ¯”è¾ƒ</span>
        instance<span class="token punctuation">.</span>subTree <span class="token operator">=</span> subTree
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">scheduler</span><span class="token operator">:</span> queueJob
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><details class="custom-container details"><summary>ç»„ä»¶å®ä¾‹å¯¹è±¡</summary>
<ul>
<li>stateï¼šç»„ä»¶è‡ªèº«çš„çŠ¶æ€æ•°æ®ï¼Œå³ data</li>
<li>isMountedï¼šä¸€ä¸ªå¸ƒå°”å€¼ï¼Œç”¨æ¥è¡¨ç¤ºç»„ä»¶æ˜¯å¦å·²ç»è¢«æŒ‚è½½</li>
<li>subTreeï¼šå­˜å‚¨ç»„ä»¶çš„æ¸²æŸ“å‡½æ•°æ‰€è¿”å›çš„è™šæ‹Ÿ DOMï¼Œå³ç»„ä»¶çš„å­æ ‘ï¼ˆsubTreeï¼‰</li>
</ul>
<p>âœ… è¿™æ ·ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®éœ€è¦ï¼Œä»»æ„å¾—åœ¨ç»„ä»¶å®ä¾‹ instance ä¸Šæ·»åŠ éœ€è¦çš„å±æ€§ã€‚ä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬åº”è¯¥å°½å¯èƒ½ä¿æŒç»„ä»¶å®ä¾‹è½»é‡ï¼Œä»¥å‡å°‘å†…å­˜å ç”¨</p>
</details>
<h3 id="å£°æ˜å‘¨æœŸå‡½æ•°" tabindex="-1"><a class="header-anchor" href="#å£°æ˜å‘¨æœŸå‡½æ•°" aria-hidden="true">#</a> å£°æ˜å‘¨æœŸå‡½æ•°</h3>
<p>ç›®å‰ç»„ä»¶å®ä¾‹çš„ isMounted å±æ€§å¯ä»¥ç”¨æ¥åŒºåˆ†ç»„ä»¶çš„æŒ‚è½½å’Œæ›´æ–°ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨åˆé€‚çš„æ—¶æœº<strong>è°ƒç”¨</strong>ç»„ä»¶çš„<strong>å£°æ˜å‘¨æœŸé’©å­</strong>ï¼š</p>
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">mountComponent</span><span class="token punctuation">(</span><span class="token parameter">vnode<span class="token punctuation">,</span> container<span class="token punctuation">,</span> anchor</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> componentOptions <span class="token operator">=</span> vnode<span class="token punctuation">.</span>type
    <span class="token keyword">let</span> <span class="token punctuation">{</span> render<span class="token punctuation">,</span> data<span class="token punctuation">,</span> beforeCreate<span class="token punctuation">,</span> created<span class="token punctuation">,</span> beforeMount<span class="token punctuation">,</span> mounted<span class="token punctuation">,</span> beforeUpdate<span class="token punctuation">,</span> updated <span class="token punctuation">}</span> <span class="token operator">=</span> componentOptions

    beforeCreate <span class="token operator">&amp;&amp;</span> <span class="token function">beforeCreate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">const</span> state <span class="token operator">=</span> data <span class="token operator">?</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">const</span> instance <span class="token operator">=</span> <span class="token punctuation">{</span>
        state<span class="token punctuation">,</span>
        <span class="token literal-property property">isMounted</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token literal-property property">subTree</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>

    vnode<span class="token punctuation">.</span>component <span class="token operator">=</span> instance

    created <span class="token operator">&amp;&amp;</span> <span class="token function">created</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span>

    <span class="token function">effect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> subTree <span class="token operator">=</span> <span class="token function">render</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span> state<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>instance<span class="token punctuation">.</span>isMounted<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            beforeMount <span class="token operator">&amp;&amp;</span> <span class="token function">beforeMount</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span>
            <span class="token function">patch</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> subTree<span class="token punctuation">,</span> container<span class="token punctuation">,</span> anchor<span class="token punctuation">)</span>
            instance<span class="token punctuation">.</span>isMounted <span class="token operator">=</span> <span class="token boolean">true</span>
            mounted <span class="token operator">&amp;&amp;</span> <span class="token function">mounted</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            beforeUpdate <span class="token operator">&amp;&amp;</span> <span class="token function">beforeUpdate</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span>
            <span class="token function">patch</span><span class="token punctuation">(</span>instance<span class="token punctuation">.</span>subTree<span class="token punctuation">,</span> subTree<span class="token punctuation">,</span> container<span class="token punctuation">,</span> anchor<span class="token punctuation">)</span>
            updated <span class="token operator">&amp;&amp;</span> <span class="token function">updated</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        instance<span class="token punctuation">.</span>subTree <span class="token operator">=</span> subTree
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">scheduler</span><span class="token operator">:</span> queueJob
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="highlight-lines"><br><br><div class="highlight-line">&nbsp;</div><br><div class="highlight-line">&nbsp;</div><br><br><br><br><br><br><br><br><br><br><br><div class="highlight-line">&nbsp;</div><br><br><br><br><div class="highlight-line">&nbsp;</div><br><br><div class="highlight-line">&nbsp;</div><br><div class="highlight-line">&nbsp;</div><br><div class="highlight-line">&nbsp;</div><br><br><br><br><br><br></div><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>âœ… åœ¨ä¸Šé¢è¿™æ®µä»£ç ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆä»ç»„ä»¶çš„é€‰é¡¹å¯¹è±¡ä¸­å–å¾—æ³¨å†Œåˆ°ç»„ä»¶ä¸Šçš„å£°æ˜å‘¨æœŸå‡½æ•°ï¼Œç„¶ååœ¨åˆé€‚çš„æ—¶æœºè°ƒç”¨å®ƒä»¬ï¼Œè¿™å…¶å®å°±æ˜¯ç»„ä»¶ç”Ÿå‘½å‘¨æœŸçš„å®ç°åŸç†ã€‚</p>
<blockquote>
<p>å®é™…ä¸Šï¼Œä¸€ä¸ªç»„ä»¶å¯ä»¥å­˜åœ¨å¤šä¸ªåŒæ ·çš„ç”Ÿå‘½å‘¨æœŸé’©å­ï¼Œä¾‹å¦‚ mixinsã€‚å› æ­¤æˆ‘ä»¬é€šå¸¸éœ€è¦å°†ç»„ä»¶çš„å£°æ˜å‘¨æœŸé’©å­åºåˆ—åŒ–ä¸ºä¸€ä¸ªæ•°ç»„ï¼Œä½†æ ¸å¿ƒåŸç†ä¸å˜ã€‚</p>
</blockquote>
<h2 id="props-ä¸ç»„ä»¶çš„è¢«åŠ¨æ›´æ–°" tabindex="-1"><a class="header-anchor" href="#props-ä¸ç»„ä»¶çš„è¢«åŠ¨æ›´æ–°" aria-hidden="true">#</a> props ä¸ç»„ä»¶çš„è¢«åŠ¨æ›´æ–°</h2>
<blockquote>
<ul>
<li>å‰¯ä½œç”¨å­æ›´æ–°æ‰€å¼•èµ·çš„å­ç»„ä»¶æ›´æ–°å«åšå­ç»„ä»¶çš„è¢«åŠ¨æ›´æ–°ã€‚</li>
<li>æ¸²æŸ“ä¸Šä¸‹æ–‡<code v-pre>renderContext</code> å®é™…ä¸Šæ˜¯ç»„ä»¶å®ä¾‹çš„ä»£ç†å¯¹è±¡ã€‚åœ¨æ¸²æŸ“å‡½æ•°å†…è®¿é—®ç»„ä»¶æ‰€æš´éœ²çš„æ•°æ®éƒ½æ˜¯é€šè¿‡è¯¥ä»£ç†å¯¹è±¡å®ç°çš„ã€‚</li>
</ul>
</blockquote>
<h3 id="props-ä¸-attrs" tabindex="-1"><a class="header-anchor" href="#props-ä¸-attrs" aria-hidden="true">#</a> props ä¸ attrs</h3>
<p>åœ¨è™šæ‹Ÿ DOM å±‚é¢ï¼Œç»„ä»¶çš„ props ä¸æ™®é€š HTML æ ‡ç­¾çš„å±æ€§å·®åˆ«ä¸å¤§ã€‚å‡è®¾æˆ‘ä»¬æœ‰æ¨¡æ¿å¦‚ä¸‹ï¼š</p>
<div class="language-html ext-html line-numbers-mode"><pre v-pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>MyComponent</span> <span class="token attr-name">title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>A Big Title<span class="token punctuation">"</span></span> <span class="token attr-name">:other</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>val<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>è¿™æ®µæ¨¡æ¿å¯¹åº”çš„è™šæ‹Ÿ DOM æ˜¯ï¼š</p>
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code><span class="token keyword">const</span> vnode <span class="token operator">=</span> <span class="token punctuation">{</span>
	<span class="token literal-property property">type</span><span class="token operator">:</span> MyComponent<span class="token punctuation">,</span>
    <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'A Big Title'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">other</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>val
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥çœ‹åˆ°ï¼Œæ¨¡æ¿ä¸è™šæ‹Ÿ DOM å‡ ä¹æ˜¯â€œåŒæ„â€çš„ã€‚åŒæ—¶ï¼Œåœ¨ç¼–å†™ç»„ä»¶æ—¶ï¼Œæˆ‘ä»¬éœ€è¦æ˜¾ç¤ºåœ°æŒ‡å®šç»„ä»¶è¦æ¥æ”¶å“ªäº›æ•°æ®ï¼š</p>
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code><span class="token keyword">const</span> MyComponent <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'MyComponent'</span><span class="token punctuation">,</span>
    <span class="token comment">// ç»„ä»¶æ¥æ”¶ä¸€ä¸ª String ç±»å‹çš„ title å±æ€§</span>
    <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">title</span><span class="token operator">:</span> String
    <span class="token punctuation">}</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'div'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">foo çš„å€¼æ˜¯ï¼š </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>title<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="custom-container tip"><p class="custom-container-title">æ‰€ä»¥å¯¹äºä¸€ä¸ªç»„ä»¶æ¥è¯´ï¼Œæœ‰ä¸¤éƒ¨åˆ†å…³äº props çš„å†…å®¹æˆ‘ä»¬éœ€è¦å…³å¿ƒï¼š</p>
<ul>
<li>ä¸ºç»„ä»¶ä¼ é€’çš„ props æ•°æ®ï¼Œå³ç»„ä»¶çš„ vnode.props å¯¹è±¡ã€‚ï¼ˆç»„ä»¶éƒ½æ¥æ”¶åˆ°äº†ä»€ä¹ˆï¼‰</li>
<li>ç»„ä»¶é€‰é¡¹å¯¹è±¡ä¸­å®šä¹‰çš„ props é€‰é¡¹ï¼Œå³ MyComponent.props å¯¹è±¡ã€‚ï¼ˆç»„ä»¶è¦ä»€ä¹ˆï¼‰</li>
</ul>
</div>
<p>æˆ‘ä»¬éœ€è¦ç»“åˆè¿™ä¸¤ä¸ªé€‰é¡¹è§£æå‡ºç»„ä»¶åœ¨æ¸²æŸ“æ—¶éœ€è¦ç”¨åˆ°çš„ props æ•°æ®ï¼š</p>
<CodeGroup>
<CodeGroupItem title="resolveProps">
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code><span class="token doc-comment comment">/**
   * <span class="token keyword">@description</span>: 
   * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span>Object<span class="token punctuation">}</span></span> <span class="token parameter">optionsï¼šç»„ä»¶propså£°æ˜è¦æ¥æ”¶çš„å±æ€§</span>
   * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span>Object<span class="token punctuation">}</span></span> <span class="token parameter">propsDataï¼švnodeèŠ‚ç‚¹æ¥æ”¶åˆ°çš„å…¨éƒ¨å±æ€§</span>
   * <span class="token keyword">@return</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token punctuation">[</span>Props<span class="token punctuation">,</span> Attrs<span class="token punctuation">]</span><span class="token punctuation">}</span></span>
   */</span>
<span class="token keyword">function</span> <span class="token function">resolveProps</span><span class="token punctuation">(</span><span class="token parameter">options<span class="token punctuation">,</span> propsData</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> props <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">const</span> attrs <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> propsData<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// å¦‚æœå±æ€§è¢«ç»„ä»¶å£°æ˜åœ¨ props å¯¹è±¡ä¸­ï¼Œåˆ™ä¸º props</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>options <span class="token operator">&amp;&amp;</span> key <span class="token keyword">in</span> options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            props<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> propsData<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// å¦åˆ™å°±æ˜¯ attrs</span>
            attrs<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> propsData<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token punctuation">[</span> props<span class="token punctuation">,</span> attrs <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></CodeGroupItem>
<CodeGroupItem title="props ä¸ attrs è§£æ">
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">mountComponent</span><span class="token punctuation">(</span><span class="token parameter">vnode<span class="token punctuation">,</span> container<span class="token punctuation">,</span> anchor</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> componentOptions <span class="token operator">=</span> vnode<span class="token punctuation">.</span>type
    <span class="token keyword">let</span> <span class="token punctuation">{</span> render<span class="token punctuation">,</span> data<span class="token punctuation">,</span> <span class="token literal-property property">props</span><span class="token operator">:</span> propsOption <span class="token comment">/* å…¶å®ƒçœç•¥ */</span> <span class="token punctuation">}</span> <span class="token operator">=</span> componentOptions

    beforeCreate <span class="token operator">&amp;&amp;</span> <span class="token function">beforeCreate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">const</span> state <span class="token operator">=</span> data <span class="token operator">?</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                                  
    <span class="token comment">// è°ƒç”¨ resolveProps å‡½æ•°è§£æå‡ºæœ€ç»ˆçš„ props æ•°æ®ä¸ attrs æ•°æ®</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>props<span class="token punctuation">,</span> attrs<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">resolveProps</span><span class="token punctuation">(</span>propsOption<span class="token punctuation">,</span> vnode<span class="token punctuation">.</span>props<span class="token punctuation">)</span>

    <span class="token keyword">const</span> instance <span class="token operator">=</span> <span class="token punctuation">{</span>
        state<span class="token punctuation">,</span>
        <span class="token comment">// å°†è§£æå‡ºçš„ props æ•°æ®ä¿åŒ…è£…ä¸º shallowReactive å¹¶å®šä¹‰åˆ°ç»„ä»¶å®ä¾‹ä¸Š</span>
        <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token function">shallowReactive</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">isMounted</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token literal-property property">subTree</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>

    vnode<span class="token punctuation">.</span>component <span class="token operator">=</span> instance

    created <span class="token operator">&amp;&amp;</span> <span class="token function">created</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span>

    <span class="token function">effect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> subTree <span class="token operator">=</span> <span class="token function">render</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span> state<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>instance<span class="token punctuation">.</span>isMounted<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            beforeMount <span class="token operator">&amp;&amp;</span> <span class="token function">beforeMount</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span>
            <span class="token function">patch</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> subTree<span class="token punctuation">,</span> container<span class="token punctuation">,</span> anchor<span class="token punctuation">)</span>
            instance<span class="token punctuation">.</span>isMounted <span class="token operator">=</span> <span class="token boolean">true</span>
            mounted <span class="token operator">&amp;&amp;</span> <span class="token function">mounted</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            beforeUpdate <span class="token operator">&amp;&amp;</span> <span class="token function">beforeUpdate</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span>
            <span class="token function">patch</span><span class="token punctuation">(</span>instance<span class="token punctuation">.</span>subTree<span class="token punctuation">,</span> subTree<span class="token punctuation">,</span> container<span class="token punctuation">,</span> anchor<span class="token punctuation">)</span>
            updated <span class="token operator">&amp;&amp;</span> <span class="token function">updated</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        instance<span class="token punctuation">.</span>subTree <span class="token operator">=</span> subTree
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">scheduler</span><span class="token operator">:</span> queueJob
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></CodeGroupItem>
</CodeGroup>
<blockquote>
<p>åœ¨ Vue.js3 ä¸­ï¼Œæ²¡æœ‰å®šä¹‰åœ¨ MyComponent.props é€‰é¡¹ä¸­çš„ props æ•°æ®å°†å­˜å‚¨åˆ° attrs å¯¹è±¡ä¸­ã€‚</p>
<p>ä¸Šè¿°å®ç°æ²¡æœ‰åŒ…å«é»˜è®¤å€¼ã€ç±»å‹æ ¡éªŒç­‰å†…å®¹çš„å¤„ç†ã€‚å®é™…ä¸Šï¼Œè¿™äº›å†…å®¹ä¹Ÿéƒ½æ˜¯å›´ç»• MyComponent.props å’Œ vnode.props è¿™ä¸¤ä¸ªå¯¹è±¡å±•å¼€çš„ã€‚</p>
</blockquote>
<h3 id="è¢«åŠ¨æ›´æ–°" tabindex="-1"><a class="header-anchor" href="#è¢«åŠ¨æ›´æ–°" aria-hidden="true">#</a> è¢«åŠ¨æ›´æ–°</h3>
<div class="language-html ext-html line-numbers-mode"><pre v-pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>child-component</span> <span class="token attr-name">:title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>title<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>å‡è®¾çˆ¶ç»„ä»¶å†…ä½¿ç”¨äº†å­ç»„ä»¶ï¼Œå¹¶ä¸”ä¼ é€’äº†ä¸€ä¸ªå“åº”å¼æ•°æ® titleã€‚å½“ title å‘ç”Ÿå˜åŒ–æ—¶ï¼Œçˆ¶ç»„ä»¶çš„æ¸²æŸ“å‡½æ•°ä¼šé‡æ–°æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯<strong>è‡ªæ›´æ–°</strong>ã€‚åœ¨æ›´æ–°è¿‡ç¨‹ä¸­ï¼Œæ¸²æŸ“å™¨å‘ç°çˆ¶ç»„ä»¶çš„ <code v-pre>subTree</code> åŒ…å«ç»„ä»¶ç±»å‹çš„è™šæ‹ŸèŠ‚ç‚¹ï¼Œæ‰€ä»¥ä¼šè°ƒç”¨ <code v-pre>patchComponent</code> å‡½æ•°å®Œæˆå­ç»„ä»¶çš„æ›´æ–°ã€‚</p>
<div class="custom-container tip"><p class="custom-container-title">è¢«åŠ¨æ›´æ–°: ç”±çˆ¶ç»„ä»¶è‡ªæ›´æ–°æ‰€å¼•èµ·çš„å­ç»„ä»¶æ›´æ–°</p>
<ul>
<li>æ£€æµ‹å­ç»„ä»¶æ˜¯å¦çœŸçš„éœ€è¦æ›´æ–°ï¼Œå› ä¸ºå­ç»„ä»¶çš„ props å¯èƒ½æ˜¯ä¸å˜çš„ï¼›</li>
<li>å¦‚æœéœ€è¦æ›´æ–°ï¼Œåˆ™æ›´æ–°å­ç»„ä»¶çš„ propsã€slots ç­‰å†…å®¹ã€‚</li>
</ul>
</div>
<CodeGroup>
<CodeGroupItem title="patchComponent">
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">patchComponent</span><span class="token punctuation">(</span><span class="token parameter">n1<span class="token punctuation">,</span> n2<span class="token punctuation">,</span> anchor</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// è·å–ç»„ä»¶å®ä¾‹ï¼Œå³ n1 æ—§ vnode çš„componentï¼ŒåŒæ—¶è®©æ–°çš„ç»„ä»¶è™šæ‹ŸèŠ‚ç‚¹ n2.component ä¹ŸæŒ‡å‘ç»„ä»¶å®ä¾‹</span>
    <span class="token keyword">const</span> instance <span class="token operator">=</span> <span class="token punctuation">(</span>n2<span class="token punctuation">.</span>component <span class="token operator">=</span> n1<span class="token punctuation">.</span>component<span class="token punctuation">)</span>
    <span class="token comment">// è·å–å½“å‰çš„ props æ•°æ®</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> props <span class="token punctuation">}</span> <span class="token operator">=</span> instance
    <span class="token comment">// æ£€æµ‹ä¼ é€’ç»™å­ç»„ä»¶çš„ props æ˜¯å¦å‘ç”Ÿå˜åŒ–ï¼Œæœ‰å˜åŒ–æ‰æ›´æ–°</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">hasPropsChanged</span><span class="token punctuation">(</span>n1<span class="token punctuation">.</span>props<span class="token punctuation">,</span> n2<span class="token punctuation">.</span>props<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// è°ƒç”¨ resolveProps é‡æ–°è·å– props æ•°æ®</span>
        <span class="token keyword">const</span> <span class="token punctuation">[</span> nextProps<span class="token punctuation">,</span> nextAttrs <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">resolveProps</span><span class="token punctuation">(</span>n2<span class="token punctuation">.</span>type<span class="token punctuation">.</span>props<span class="token punctuation">,</span> n2<span class="token punctuation">.</span>props<span class="token punctuation">)</span>
        <span class="token comment">// props æ›´æ–°ä¸åˆ é™¤</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> k <span class="token keyword">in</span> nextProps<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            props<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> nextProps<span class="token punctuation">[</span>k<span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> k <span class="token keyword">in</span> props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>k <span class="token keyword">in</span> nextProps<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">delete</span> props<span class="token punctuation">[</span>k<span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></CodeGroupItem>
<CodeGroupItem title="hasPropsChanged">
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">hasPropsChanged</span><span class="token punctuation">(</span><span class="token parameter">prevProps<span class="token punctuation">,</span> nextProps</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> nextKeys <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>nextProps<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>nextKeys<span class="token punctuation">.</span>length <span class="token operator">!==</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>prevProps<span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> nextKeys<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> key <span class="token operator">=</span> nextKeys<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
        <span class="token keyword">return</span> nextProps<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">!==</span> prevProps<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></CodeGroupItem>
</CodeGroup>
<ul>
<li>éœ€è¦æŠŠç»„ä»¶å®ä¾‹æ·»åŠ åˆ°æ–°çš„ç»„ä»¶ vnode å¯¹è±¡ä¸Šï¼Œå³ <code v-pre>n2.component = n1.component</code>ï¼Œå¦åˆ™ä¸‹æ¬¡æ›´æ–°æ—¶å°†æ— æ³•å–å¾—ç»„ä»¶å®ä¾‹ï¼›</li>
<li><code v-pre>instance.props</code> å¯¹è±¡æœ¬èº«æ˜¯æµ…å“åº”çš„ï¼ˆshallowReactiveï¼‰ã€‚å› æ­¤ï¼Œåœ¨æ›´æ–°ç»„ä»¶ props æ—¶ï¼Œåªéœ€è¦è®¾ç½® <code v-pre>instance.props</code> å¯¹è±¡ä¸‹çš„å±æ€§å€¼å³å¯è§¦å‘ç»„ä»¶é‡æ–°æ¸²æŸ“ã€‚</li>
</ul>
<h3 id="æ¸²æŸ“ä¸Šä¸‹æ–‡å¯¹è±¡" tabindex="-1"><a class="header-anchor" href="#æ¸²æŸ“ä¸Šä¸‹æ–‡å¯¹è±¡" aria-hidden="true">#</a> æ¸²æŸ“ä¸Šä¸‹æ–‡å¯¹è±¡</h3>
<p>ç”±äº props æ•°æ®ä¸ç»„ä»¶è‡ªèº«çš„çŠ¶æ€æ•°æ®éƒ½éœ€è¦æš´éœ²åˆ°æ¸²æŸ“å‡½æ•°ä¸­ï¼Œå¹¶ä½¿å¾—æ¸²æŸ“å‡½æ•°èƒ½å¤Ÿé€šè¿‡ this è®¿é—®å®ƒä»¬ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦å°è£…ä¸€ä¸ªæ¸²æŸ“ä¸Šä¸‹æ–‡å¯¹è±¡ã€‚</p>
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">mountComponent</span><span class="token punctuation">(</span><span class="token parameter">vnode<span class="token punctuation">,</span> container<span class="token punctuation">,</span> anchor</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    <span class="token keyword">const</span> instance <span class="token operator">=</span> <span class="token punctuation">{</span>
        state<span class="token punctuation">,</span>
        <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token function">shallowReactive</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">isMounted</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token literal-property property">subTree</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>

    vnode<span class="token punctuation">.</span>component <span class="token operator">=</span> instance
    <span class="token comment">// åˆ›å»ºæ¸²æŸ“ä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œæœ¬è´¨æ˜¯ç»„ä»¶å®ä¾‹çš„ä»£ç†</span>
    <span class="token keyword">const</span> renderContext <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>instance<span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token function">get</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> k<span class="token punctuation">,</span> r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> <span class="token punctuation">{</span> state<span class="token punctuation">,</span> props<span class="token punctuation">,</span> slots <span class="token punctuation">}</span> <span class="token operator">=</span> t

            <span class="token keyword">if</span> <span class="token punctuation">(</span>k <span class="token operator">===</span> <span class="token string">'$slots'</span><span class="token punctuation">)</span> <span class="token keyword">return</span> slots

            <span class="token keyword">if</span> <span class="token punctuation">(</span>state <span class="token operator">&amp;&amp;</span> k <span class="token keyword">in</span> state<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> state<span class="token punctuation">[</span>k<span class="token punctuation">]</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>k <span class="token keyword">in</span> props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> props<span class="token punctuation">[</span>k<span class="token punctuation">]</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>setupState <span class="token operator">&amp;&amp;</span> k <span class="token keyword">in</span> setupState<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> setupState<span class="token punctuation">[</span>k<span class="token punctuation">]</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'ä¸å­˜åœ¨'</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function">set</span> <span class="token punctuation">(</span>t<span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">,</span> r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> <span class="token punctuation">{</span> state<span class="token punctuation">,</span> props <span class="token punctuation">}</span> <span class="token operator">=</span> t
            <span class="token keyword">if</span> <span class="token punctuation">(</span>state <span class="token operator">&amp;&amp;</span> k <span class="token keyword">in</span> state<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                state<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> v
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>k <span class="token keyword">in</span> props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                props<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> v
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>setupState <span class="token operator">&amp;&amp;</span> k <span class="token keyword">in</span> setupState<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                setupState<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> v
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'ä¸å­˜åœ¨'</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token comment">// å£°æ˜å‘¨æœŸå‡½æ•°è°ƒç”¨æ—¶è¦ç»‘å®šæ¸²æŸ“ä¸Šä¸‹æ–‡å¯¹è±¡</span>
    created <span class="token operator">&amp;&amp;</span> <span class="token function">created</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>renderContext<span class="token punctuation">)</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>âœ…  é€šè¿‡åˆ›å»ºä¸€ä¸ªç»„ä»¶å®ä¾‹çš„<strong>ä»£ç†å¯¹è±¡</strong>ï¼Œè¿™ä¸ªå¯¹è±¡å°±æ˜¯æ¸²æŸ“ä¸Šä¸‹æ–‡å¯¹è±¡ã€‚æ¯å½“æ¸²æŸ“å‡½æ•°æˆ–è€…å£°æ˜å‘¨æœŸå‡½æ•°é’©å­ä¸­é€šè¿‡ this æ¥è®¿é—®æ•°æ®æ—¶ï¼Œéƒ½ä¼šä¼˜å…ˆä»ç»„ä»¶è‡ªèº«çŠ¶æ€ä¸­è¯»å–ï¼Œå¦‚æœç»„ä»¶æœ¬èº«æ²¡æœ‰å¯¹åº”çš„æ•°æ®ï¼Œåˆ™å†ä» props æ•°æ®ä¸­è¯»å–ã€‚ç„¶åæˆ‘ä»¬å°†è¿™ä¸ªæ¸²æŸ“ä¸Šä¸‹æ–‡å¯¹è±¡ä½œä¸ºæ¸²æŸ“å‡½æ•°å’Œå£°æ˜å‘¨æœŸé’©å­å‡½æ•°çš„ this å³å¯ã€‚</p>
<blockquote>
<p>é™¤äº†ç»„ä»¶è‡ªèº«çš„æ•°æ®å’Œ props æ•°æ®ä¹‹å¤–ï¼Œå®Œæ•´çš„ç»„ä»¶è¿˜åŒ…å« methodsã€computed ç­‰ç»„ä»¶é€‰é¡¹ä¸­å®šä¹‰çš„æ–¹æ³•ï¼Œè¿™äº›å†…å®¹éƒ½åº”è¯¥åœ¨æ¸²æŸ“ä¸Šä¸‹æ–‡å¯¹è±¡ä¸­å¤„ç†ã€‚</p>
</blockquote>
<h2 id="setup-å‡½æ•°çš„ä½œç”¨ä¸å®ç°" tabindex="-1"><a class="header-anchor" href="#setup-å‡½æ•°çš„ä½œç”¨ä¸å®ç°" aria-hidden="true">#</a> setup å‡½æ•°çš„ä½œç”¨ä¸å®ç°</h2>
<h3 id="setup-å‡½æ•°" tabindex="-1"><a class="header-anchor" href="#setup-å‡½æ•°" aria-hidden="true">#</a> setup å‡½æ•°</h3>
<div class="custom-container tip"><p class="custom-container-title">setup å‡½æ•°æ˜¯ Vue.js 3 æ–°å¢çš„ç»„ä»¶é€‰é¡¹ï¼Œå®ƒä¸»è¦æ˜¯ç”¨äºé…åˆç»„ä»¶å¼ APIï¼Œä¸ºç”¨æˆ·æä¾›ä¸€ä¸ªåœ°æ–¹ï¼Œç”¨äºå»ºç«‹ç»„åˆé€»è¾‘ã€åˆ›å»ºå“åº”å¼æ•°æ®ã€åˆ›å»ºé€šç”¨å‡½æ•°ã€æ³¨å†Œç”Ÿå‘½å‘¨æœŸé’©å­ç­‰èƒ½åŠ›ã€‚</p>
<ol>
<li>åœ¨ç»„ä»¶æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­ï¼Œsetup å‡½æ•°åªä¼šæ‰§è¡Œä¸€æ¬¡ï¼Œå®ƒçš„<strong>è¿”å›å€¼</strong>å¯ä»¥æ˜¯ä¸€ä¸ª render å‡½æ•°ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼›</li>
<li>setup å‡½æ¥æ¥æ”¶ä¸¤ä¸ª<strong>å‚æ•°</strong>ï¼Œåˆ†åˆ«æ˜¯ props æ•°æ®å¯¹è±¡å’Œä¸€ä¸ª setupContext å¯¹è±¡ã€‚</li>
</ol>
</div>
<details class="custom-container details"><summary>setupContext</summary>
<ul>
<li>slotsï¼šç»„ä»¶æ¥æ”¶åˆ°çš„æ’æ§½ã€‚</li>
<li>emitï¼šä¸€ä¸ªå‡½æ•°ï¼Œç”¨æ¥å‘å°„è‡ªå®šä¹‰äº‹ä»¶ã€‚</li>
<li>attrsï¼šå½“ä¸ºç»„ä»¶ä¼ é€’ props æ—¶ï¼Œé‚£äº›æ²¡æœ‰æ˜¾ç¤ºåœ°å£°æ˜ä¸º props å±æ€§ä¼šå­˜å‚¨åˆ° attrs ä¸­ã€‚</li>
<li>exposeï¼šä¸€ä¸ªå‡½æ•°ï¼Œç”¨æ¥æ˜¾ç¤ºå®šä¹‰ç»„ä»¶å¯¹å¤–æš´éœ²çš„æ•°æ®ã€‚</li>
</ul>
</details>
<CodeGroup>
<CodeGroupItem title="è¿”å› render å‡½æ•°">
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code><span class="token keyword">const</span> comp <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token comment">// setup å‡½æ•°å¯ä»¥è¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°å°†ä½œä¸ºç»„ä»¶çš„æ¸²æŸ“å‡½æ•°</span>
    <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token string">'hello'</span> <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></CodeGroupItem>
<CodeGroupItem title="è¿”å›å¯¹è±¡">
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code><span class="token keyword">const</span> comp <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token comment">// setup å‡½æ•°å¯¹è±¡ï¼Œå¯¹è±¡ä¸­çš„æ•°æ®ä¼šæš´éœ²åˆ°æ¸²æŸ“å‡½æ•°ä¸­</span>
    <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span> count <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">count is: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>count<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></CodeGroupItem>
<CodeGroupItem title="å‚æ•°">
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code><span class="token keyword">const</span> comp <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">prosp</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">foo</span><span class="token operator">:</span> String
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">setup</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span> setupContext</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        props<span class="token punctuation">.</span>foo  <span class="token comment">// è®¿é—®ä¼ å…¥çš„ props æ•°æ®</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span> slots<span class="token punctuation">,</span> emit<span class="token punctuation">,</span> attrs<span class="token punctuation">,</span> expose <span class="token punctuation">}</span> <span class="token operator">=</span> setupContext
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></CodeGroupItem>
</CodeGroup>
<h3 id="setup-å®ç°" tabindex="-1"><a class="header-anchor" href="#setup-å®ç°" aria-hidden="true">#</a> setup å®ç°</h3>
<p>âœ…  é€šè¿‡æ£€æµ‹ setup å‡½æ•°çš„è¿”å›å€¼æ¥åˆ¤æ–­å¦‚ä½•å¤„ç†å®ƒã€‚å¦‚æœè¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œé‚£ä¹ˆç»„ä»¶çš„ render é€‰é¡¹å°†è¢«å¿½ç•¥ï¼›å¦‚æœè¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œé‚£ä¹ˆå¯¹è±¡å°†ä½œä¸ºç»„ä»¶çš„çŠ¶æ€æ•°æ® <code v-pre>setupState</code>ã€‚</p>
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">mountComponent</span><span class="token punctuation">(</span><span class="token parameter">vnode<span class="token punctuation">,</span> container<span class="token punctuation">,</span> anchor</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> componentOptions <span class="token operator">=</span> vnode<span class="token punctuation">.</span>type
    <span class="token keyword">let</span> <span class="token punctuation">{</span> render<span class="token punctuation">,</span> data<span class="token punctuation">,</span> setup <span class="token punctuation">}</span> <span class="token operator">=</span> componentOptions

    beforeCreate <span class="token operator">&amp;&amp;</span> <span class="token function">beforeCreate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">const</span> state <span class="token operator">=</span> data <span class="token operator">?</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">null</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>props<span class="token punctuation">,</span> attrs<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">resolveProps</span><span class="token punctuation">(</span>propsOption<span class="token punctuation">,</span> vnode<span class="token punctuation">.</span>props<span class="token punctuation">)</span>

    <span class="token keyword">const</span> slots <span class="token operator">=</span> vnode<span class="token punctuation">.</span>children <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

    <span class="token keyword">const</span> instance <span class="token operator">=</span> <span class="token punctuation">{</span>
        state<span class="token punctuation">,</span>
        <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token function">shallowReactive</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">isMounted</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token literal-property property">subTree</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">const</span> setupContext <span class="token operator">=</span> <span class="token punctuation">{</span> attrs <span class="token punctuation">}</span>  <span class="token comment">// emit,slots,expose...</span>
    <span class="token comment">// è°ƒç”¨ setup å‡½æ•°ï¼Œå°†åªè¯»ç‰ˆæœ¬çš„ props ä¼ ç»™ setup ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°</span>
    <span class="token comment">// setupContext ä¸ºç¬¬äºŒä¸ªå‚æ•°</span>
    <span class="token keyword">const</span> setupResult <span class="token operator">=</span> <span class="token function">setup</span><span class="token punctuation">(</span><span class="token function">shallowReadonly</span><span class="token punctuation">(</span>instance<span class="token punctuation">.</span>props<span class="token punctuation">)</span><span class="token punctuation">,</span> setupContext<span class="token punctuation">)</span>
    <span class="token keyword">let</span> setupState <span class="token operator">=</span> <span class="token keyword">null</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> setupResult <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>render<span class="token punctuation">)</span> console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'setup å‡½æ•°è¿”å›æ¸²æŸ“å‡½æ•°ï¼Œrender é€‰é¡¹å°†è¢«å¿½ç•¥'</span><span class="token punctuation">)</span>
        render <span class="token operator">=</span> setupResult
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// å¦‚æœ setup è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œåˆ™ä½œä¸ºæ•°æ®çŠ¶æ€èµ‹å€¼ç»™ setupState</span>
        setupState <span class="token operator">=</span> setupContext
    <span class="token punctuation">}</span>

    vnode<span class="token punctuation">.</span>component <span class="token operator">=</span> instance

    <span class="token keyword">const</span> renderContext <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>instance<span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token function">get</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> k<span class="token punctuation">,</span> r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> <span class="token punctuation">{</span> state<span class="token punctuation">,</span> props <span class="token punctuation">}</span> <span class="token operator">=</span> t
            <span class="token keyword">if</span> <span class="token punctuation">(</span>state <span class="token operator">&amp;&amp;</span> k <span class="token keyword">in</span> state<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> state<span class="token punctuation">[</span>k<span class="token punctuation">]</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>k <span class="token keyword">in</span> props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> props<span class="token punctuation">[</span>k<span class="token punctuation">]</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>setupState <span class="token operator">&amp;&amp;</span> k <span class="token keyword">in</span> setupState<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// æ¸²æŸ“ä¸Šä¸‹æ–‡éœ€è¦å¢åŠ å¯¹ setupState çš„æ”¯æŒ</span>
                <span class="token keyword">return</span> setupState<span class="token punctuation">[</span>k<span class="token punctuation">]</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'ä¸å­˜åœ¨'</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function">set</span> <span class="token punctuation">(</span>t<span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">,</span> r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> <span class="token punctuation">{</span> state<span class="token punctuation">,</span> props <span class="token punctuation">}</span> <span class="token operator">=</span> t
            <span class="token keyword">if</span> <span class="token punctuation">(</span>state <span class="token operator">&amp;&amp;</span> k <span class="token keyword">in</span> state<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                state<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> v
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>k <span class="token keyword">in</span> props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                props<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> v
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>setupState <span class="token operator">&amp;&amp;</span> k <span class="token keyword">in</span> setupState<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                setupState<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> v
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'ä¸å­˜åœ¨'</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">// ... created</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ç»„ä»¶äº‹ä»¶ä¸-emit-å®ç°" tabindex="-1"><a class="header-anchor" href="#ç»„ä»¶äº‹ä»¶ä¸-emit-å®ç°" aria-hidden="true">#</a> ç»„ä»¶äº‹ä»¶ä¸ emit å®ç°</h2>
<ul>
<li>ç»„ä»¶å†…é€šè¿‡ emit æ–¹æ³•å‘å°„äº‹ä»¶ï¼Œç»„ä»¶å¯ä»¥ç›‘å¬ç”± emit å‡½æ•°å‘å°„çš„è‡ªå®šä¹‰äº‹ä»¶ï¼›</li>
<li>emit å®é™…ä¸Šå°±æ˜¯æ ¹æ®åç§° å» props å¯¹è±¡ä¸­å¯»æ‰¾å¯¹åº”çš„äº‹ä»¶å¤„ç†å‡½æ•°å¹¶æ‰§è¡Œï¼›</li>
<li>åªéœ€è¦å®ç° emit å‡½æ•°å¹¶æ·»åŠ åˆ° setupContext å¯¹è±¡ä¸­ï¼›</li>
<li>æˆ‘ä»¬çº¦å®š on å¼€å¤´çš„ props å±æ€§è¦ä½œä¸ºäº‹ä»¶å¤„ç†ï¼Œæ‰€ä»¥è¿™äº›å±æ€§è¦éƒ½æ”¾åˆ° props å½“ä¸­ã€‚</li>
</ul>
<CodeGroup>
<CodeGroupItem title="emit">
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code><span class="token keyword">const</span> MyComponen <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'MyComponent'</span>
    <span class="token function">setup</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span> <span class="token punctuation">{</span> emit <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// å‘å°„ change äº‹ä»¶ï¼Œå¹¶ä¼ é€’å¿…è¦å‚æ•°</span>
        <span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'change'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token comment">// ...</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></CodeGroupItem>
<CodeGroupItem title="onchange">
<div class="language-html ext-html line-numbers-mode"><pre v-pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>MyComponen</span> <span class="token attr-name">@change</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>handler<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></CodeGroupItem>
<CodeGroupItem title="è™šæ‹Ÿ DOM">
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code><span class="token keyword">const</span> CompVNode <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> MyComponent<span class="token punctuation">,</span>
    <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">onChange</span><span class="token operator">:</span> handler
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></CodeGroupItem>
<CodeGroupItem title="å®ç° emit">
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">emit</span><span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> <span class="token operator">...</span>payload</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> eventName <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">on</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>event<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> event<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
    <span class="token keyword">const</span> handler <span class="token operator">=</span> instance<span class="token punctuation">.</span>props<span class="token punctuation">[</span>eventName<span class="token punctuation">]</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>handler<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">handler</span><span class="token punctuation">(</span><span class="token operator">...</span>payload<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'äº‹ä»¶ä¸å­˜åœ¨'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></CodeGroupItem>
<CodeGroupItem title="resolveProps è°ƒæ•´">
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">resolveProps</span><span class="token punctuation">(</span><span class="token parameter">options<span class="token punctuation">,</span> propsData</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> props <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">const</span> attrs <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> propsData<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// ä»¥å­—ç¬¦ä¸² on å¼€å¤´çš„ props, æ— è®ºæ˜¯å¦æ˜¾ç¤ºåœ°å£°æ˜ä½¿ç”¨ï¼Œéƒ½æ·»åŠ åˆ° props è€Œä¸æ˜¯ attrs</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>options <span class="token operator">&amp;&amp;</span> key <span class="token keyword">in</span> options<span class="token punctuation">)</span> <span class="token operator">||</span> key<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">'on'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            props<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> propsData<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            attrs<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> propsData<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span> props<span class="token punctuation">,</span> attrs <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></CodeGroupItem>
</CodeGroup>
<blockquote>
<p>Vue.js 3 éœ€è¦åœ¨ emits å±æ€§ä¸­å£°æ˜ç»„ä»¶ä¼š emit çš„äº‹ä»¶ï¼Œé‚£ä¹ˆ <code v-pre>resolveProps</code> å¯ä»¥é€šè¿‡è¿™ä¸ª emits æ¥åˆ¤æ–­å±æ€§æ˜¯ä¸æ˜¯éœ€è¦æ”¾åˆ° props é‡Œ</p>
</blockquote>
<h2 id="æ’æ§½çš„å·¥ä½œåŸç†åŠå®ç°" tabindex="-1"><a class="header-anchor" href="#æ’æ§½çš„å·¥ä½œåŸç†åŠå®ç°" aria-hidden="true">#</a> æ’æ§½çš„å·¥ä½œåŸç†åŠå®ç°</h2>
<blockquote>
<ul>
<li>ç»„ä»¶çš„æ’æ§½å€Ÿé‰´äº† Web Component ä¸­ <code v-pre>&lt;slot&gt;</code> æ ‡ç­¾çš„æ¦‚å¿µã€‚æ’æ§½å†…å®¹ä¼šè¢«ç¼–è¯‘æˆæ’æ§½å‡½æ•°ï¼Œæ’æ§½å‡½æ•°çš„è¿”å›å€¼å°±æ˜¯å‘æ’æ§½ä¸­å¡«å……çš„å†…å®¹ã€‚</li>
<li><code v-pre>&lt;slot&gt;</code>  æ ‡ç­¾åˆ™ä¼šè¢«ç¼–è¯‘ä¸ºæ’æ§½å‡½æ•°çš„è°ƒç”¨ï¼Œé€šè¿‡æ‰§è¡Œå¯¹åº”çš„æ’æ§½å‡½æ•°ï¼Œå¾—åˆ°å¤–éƒ¨å‘æ§½ä½å¡«å……çš„å†…å®¹ï¼ˆå³è™šæ‹Ÿ DOMï¼‰ï¼Œæœ€åå°†è¯¥å†…å®¹æ¸²æŸ“åˆ°æ§½ä½ä¸­ã€‚</li>
</ul>
</blockquote>
<CodeGroup>
<CodeGroupItem title="ç»„ä»¶æ¨¡æ¿">
<div class="language-html ext-html line-numbers-mode"><pre v-pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>header</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>header<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>header</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>body<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>footer</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>footer<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>footer</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é¡¾åæ€ä¹‰ï¼Œç»„ä»¶çš„æ’æ§½æŒ‡ç»„ä»¶ä¼šé¢„ç•™ä¸€ä¸ªæ§½ä½ï¼Œè¯¥æ§½ä½å…·ä½“è¦æ¸²æŸ“çš„å†…å®¹ç”±ç”¨æˆ·æ’å…¥</p>
</CodeGroupItem>
<CodeGroupItem title="çˆ¶ç»„ä»¶">
<div class="language-html ext-html line-numbers-mode"><pre v-pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>MyComponent</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">#header</span><span class="token punctuation">></span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>æˆ‘æ˜¯æ ‡é¢˜<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">#body</span><span class="token punctuation">></span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>section</span><span class="token punctuation">></span></span>æˆ‘æ˜¯å†…å®¹<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>section</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">#footer</span><span class="token punctuation">></span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>æˆ‘æ˜¯è„šæ³¨<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>MyComponent</span><span class="token punctuation">></span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å½“çˆ¶ç»„ä»¶ä½¿ç”¨<code v-pre>&lt;MyComponen&gt;</code> ç»„ä»¶æ—¶ï¼Œå¯ä»¥æ ¹æ®æ’æ§½çš„åå­—æ¥æ’å…¥è‡ªå®šä¹‰çš„å†…å®¹</p>
</CodeGroupItem>
<CodeGroupItem title="çˆ¶ç»„ä»¶ render å‡½æ•°">
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code><span class="token comment">// çˆ¶ç»„ä»¶çš„æ¸²æŸ“å‡½æ•°</span>
<span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> MyComponent<span class="token punctuation">,</span>
        <span class="token comment">// ç»„ä»¶çš„ children ä¼šè¢«ç¼–è¯‘æˆä¸€ä¸ªå¯¹è±¡</span>
        <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token function">header</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'h1'</span><span class="token punctuation">,</span> <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token string">'æˆ‘æ˜¯æ ‡é¢˜'</span> <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token function">body</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'section'</span><span class="token punctuation">,</span> <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token string">'æˆ‘æ˜¯å†…å®¹'</span> <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token function">footer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'p'</span><span class="token punctuation">,</span> <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token string">'æˆ‘æ˜¯çŒªè„š'</span> <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>âœ… ç»„ä»¶æ¨¡æ¿ä¸­çš„æ’æ§½å†…å®¹ä¼šè¢«ç¼–è¯‘ä¸º<strong>æ’æ§½å‡½æ•°</strong>ï¼Œè€Œæ’æ§½å‡½æ•°çš„è¿”å›å€¼å°±æ˜¯å…·ä½“çš„æ’æ§½å†…å®¹ã€‚</p>
</CodeGroupItem>
<CodeGroupItem title="MyComponent render å‡½æ•°">
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code><span class="token comment">//  MyComponent ç»„ä»¶çš„æ¸²æŸ“å‡½æ•°</span>
<span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'header'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>$slots<span class="token punctuation">.</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'body'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>$slots<span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'footer'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>$slots<span class="token punctuation">.</span><span class="token function">footer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>âœ… æ¸²æŸ“æ’æ§½çš„è¿‡ç¨‹ï¼Œå°±æ˜¯è°ƒç”¨æ’æ§½å‡½æ•°å¹¶æ¸²æŸ“æœ‰å…¶è¿”å›çš„å†…å®¹çš„è¿‡ç¨‹</p>
</CodeGroupItem>
<CodeGroupItem title="slots å¤„ç†">
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">mountComponent</span><span class="token punctuation">(</span><span class="token parameter">vnode<span class="token punctuation">,</span> container<span class="token punctuation">,</span> anchor</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>

    <span class="token comment">// ç›´æ¥ä½¿ç”¨ç¼–è¯‘å¥½çš„ vnode.children å¯¹è±¡ä½œä¸º slots å¯¹è±¡å³å¯</span>
    <span class="token keyword">const</span> slots <span class="token operator">=</span> vnode<span class="token punctuation">.</span>children <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    
    <span class="token comment">// å°† slots å¯¹è±¡æ·»åŠ åˆ° setupContext å¯¹è±¡ä¸­</span>
    <span class="token keyword">const</span> setupContext <span class="token operator">=</span>  <span class="token punctuation">{</span> attrs<span class="token punctuation">,</span> emit<span class="token punctuation">.</span> slots <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿è¡Œæ—¶çš„å®ç°ä¸Šï¼Œæ’æ§½åˆ™ä¾èµ–äº setupContext ä¸­çš„ slots å¯¹è±¡</p>
</CodeGroupItem>
<CodeGroupItem title="æœ€å°å®ç°">
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">mountComponent</span><span class="token punctuation">(</span><span class="token parameter">vnode<span class="token punctuation">,</span> container<span class="token punctuation">,</span> anchor</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    <span class="token keyword">const</span> slots <span class="token operator">=</span> vnode<span class="token punctuation">.</span>children <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

    <span class="token keyword">const</span> instance <span class="token operator">=</span> <span class="token punctuation">{</span>
        state<span class="token punctuation">,</span>
        <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token function">shallowReactive</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">isMounted</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token literal-property property">subTree</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
        slots<span class="token punctuation">,</span>  <span class="token comment">// å°†æ’æ§½æ·»åŠ åˆ°ç»„ä»¶å®ä¾‹ä¸Š</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// ...</span>

    <span class="token keyword">const</span> renderContext <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>instance<span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token function">get</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> k<span class="token punctuation">,</span> r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> <span class="token punctuation">{</span> state<span class="token punctuation">,</span> props<span class="token punctuation">,</span> slots <span class="token punctuation">}</span> <span class="token operator">=</span> t
            <span class="token comment">// å½“ k çš„å€¼ä¸º $slots æ—¶ï¼Œç›´æ¥è¿”å›ç»„ä»¶å®ä¾‹ä¸Šçš„ slots</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>k <span class="token operator">===</span> <span class="token string">'$slots'</span><span class="token punctuation">)</span> <span class="token keyword">return</span> slots
            
            <span class="token comment">// ...</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function">set</span> <span class="token punctuation">(</span>t<span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">,</span> r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// ...</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æˆ‘ä»¬å¯¹ æ¸²æŸ“ä¸Šä¸‹æ–‡ <code v-pre>renderContext</code> ä»£ç†å¯¹è±¡çš„ get æ‹¦æˆªå‡½æ•°åšäº†ç‰¹æ®Šå¤„ç†ï¼Œå½“è¯»å–çš„é”®æ˜¯ $slots æ—¶ï¼Œç›´æ¥è¿”å›ç»„ä»¶å®ä¾‹ä¸Šçš„ slots å¯¹è±¡ï¼Œè¿™æ ·ç”¨æˆ·å°±å¯ä»¥é€šè¿‡ this.$slots æ¥è®¿é—®æ’æ§½å†…å®¹äº†ã€‚</p>
</CodeGroupItem>
</CodeGroup>
<blockquote>
<p>ç»„ä»¶æ’æ§½å‡½æ•°çš„è°ƒç”¨æ˜¯ä¸€å®šçš„ï¼Œå¤–éƒ¨æ˜¯å¦ä¼ å…¥æ’æ§½å‡½æ•°æ˜¯ä¸ç¡®å®šçš„ã€‚</p>
</blockquote>
<h2 id="æ³¨å†Œç”Ÿå‘½å‘¨æœŸ" tabindex="-1"><a class="header-anchor" href="#æ³¨å†Œç”Ÿå‘½å‘¨æœŸ" aria-hidden="true">#</a> æ³¨å†Œç”Ÿå‘½å‘¨æœŸ</h2>
<p>åœ¨ Vue.js 3ä¸­ï¼Œä¸€éƒ¨åˆ†ç»„åˆå¼ API æ˜¯ç”¨æ¥æ³¨å†Œç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°ï¼ˆonMountedã€onUpdatedç­‰ç­‰ï¼‰ã€‚å®ƒä»¬å¯ä»¥è¢«<strong>å¤šæ¬¡</strong>è°ƒç”¨æ³¨å†Œã€‚</p>
<p>âœ…  åœ¨ä¸åŒçš„ç»„ä»¶ä¸­è°ƒç”¨ç”Ÿå‘½å‘¨æœŸé’©å­æ³¨å†Œå‡½æ•°ä¼šå°†å…¶æ³¨å†Œåˆ°å½“å‰ç»„ä»¶ä¸Šï¼Œè¿™ä¸ªå¯ä»¥ç”±ä¸€ä¸ªå˜é‡<code v-pre>currentInstance</code> å­˜å‚¨å½“å‰ç»„ä»¶å®ä¾‹å®ç°ã€‚è¿™ä¸ªæ€è·¯å’Œ<code v-pre>activeEffect</code>ä¸€è‡´ã€‚é€šè¿‡å®ƒè·å–å½“å‰æ­£åœ¨è¢«åˆå§‹åŒ–çš„ç»„ä»¶å®ä¾‹ï¼Œä»è€Œå°†é‚£äº›é€šè¿‡ <code v-pre>onMounted</code> å‡½æ•°æ³¨å†Œçš„é’©å­å‡½æ•°ä¸ç»„ä»¶å®ä¾‹è¿›è¡Œå…³è”ã€‚</p>
<CodeGroup>
<CodeGroupItem title="currentInstance">
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code><span class="token comment">// å…¨å±€å˜é‡ï¼Œå­˜å‚¨å½“å‰æ­£åœ¨è¢«åˆå§‹åŒ–çš„ç»„ä»¶å®ä¾‹</span>
<span class="token keyword">let</span> currentInstance <span class="token operator">=</span> <span class="token keyword">null</span>

<span class="token keyword">function</span> <span class="token function">setCurrentInstance</span><span class="token punctuation">(</span><span class="token parameter">instance</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    currentInstance <span class="token operator">=</span> instance
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></CodeGroupItem>
<CodeGroupItem title="mountComponent">
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">mountComponent</span><span class="token punctuation">(</span><span class="token parameter">vnode<span class="token punctuation">,</span> container<span class="token punctuation">,</span> anchor</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    <span class="token keyword">const</span> instance <span class="token operator">=</span> <span class="token punctuation">{</span>
        state<span class="token punctuation">,</span>
        <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token function">shallowReactive</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">isMounted</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token literal-property property">subTree</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
        slots<span class="token punctuation">,</span>
        <span class="token comment">// å­˜å‚¨ onMounted æ³¨å†Œçš„ç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°</span>
        <span class="token literal-property property">mounted</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">const</span> setupContext <span class="token operator">=</span> <span class="token punctuation">{</span> attrs<span class="token punctuation">,</span> emit<span class="token punctuation">,</span> slots <span class="token punctuation">}</span>

    <span class="token comment">// åœ¨è°ƒç”¨ setup ä¹‹å‰ï¼Œè®¾ç½®å½“å‰ç»„ä»¶å®ä¾‹</span>
    <span class="token function">setCurrentInstance</span><span class="token punctuation">(</span>prevInstance<span class="token punctuation">)</span>
    <span class="token comment">// æ‰§è¡Œ setup å‡½æ•°</span>
    <span class="token keyword">const</span> setupResult <span class="token operator">=</span> <span class="token function">setup</span><span class="token punctuation">(</span><span class="token function">shallowReadonly</span><span class="token punctuation">(</span>instance<span class="token punctuation">.</span>props<span class="token punctuation">)</span><span class="token punctuation">,</span> setupContext<span class="token punctuation">)</span>
    <span class="token comment">// åœ¨ setup å‡½æ•°æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œé‡ç½®å½“å‰ç»„ä»¶å®ä¾‹</span>
    <span class="token function">setCurrentInstance</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>
    
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä»¥ä¸Šä»£ç ä»¥ onMounted å‡½æ•°ä¸ºä¾‹ã€‚åœ¨ instance.mounted æ•°ç»„å­˜å‚¨æ³¨å†Œçš„ç”Ÿå‘½å‘¨æœŸé’©å­ã€‚</p>
</CodeGroupItem>
<CodeGroupItem title="onMounted">
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">onMounted</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>currentInstance<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        currentInstance<span class="token punctuation">.</span>mounted<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'onMounted å‡½æ•°åªèƒ½åœ¨ setupä¸­è°ƒç”¨'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯è§æ•´ä½“çš„å®ç°éå¸¸ç›´è§‚ã€‚åªéœ€è¦é€šè¿‡ currentInstance è·å–å½“å‰ç»„ä»¶å®ä¾‹çš„ç”Ÿå‘½å‘¨æœŸé’©å­æ•°ç»„ï¼Œç„¶åæ·»åŠ å³å¯ã€‚</p>
</CodeGroupItem>
<CodeGroupItem title="æ‰§è¡Œç”Ÿå‘½å‘¨æœŸé’©å­">
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">mountComponent</span><span class="token punctuation">(</span><span class="token parameter">vnode<span class="token punctuation">,</span> container<span class="token punctuation">,</span> anchor</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    
    <span class="token function">effect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> subTree <span class="token operator">=</span> <span class="token function">render</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>renderContext<span class="token punctuation">,</span> renderContext<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>instance<span class="token punctuation">.</span>isMounted<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            beforeMount <span class="token operator">&amp;&amp;</span> <span class="token function">beforeMount</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>renderContext<span class="token punctuation">)</span>
            <span class="token function">patch</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> subTree<span class="token punctuation">,</span> container<span class="token punctuation">,</span> anchor<span class="token punctuation">)</span>
            instance<span class="token punctuation">.</span>isMounted <span class="token operator">=</span> <span class="token boolean">true</span>
            mounted <span class="token operator">&amp;&amp;</span> <span class="token function">mounted</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>renderContext<span class="token punctuation">)</span>
            <span class="token comment">// éå† instance.mounted æ•°ç»„å¹¶é€ä¸ªæ‰§è¡Œå³å¯</span>
            instance<span class="token punctuation">.</span>mounted <span class="token operator">&amp;&amp;</span> instance<span class="token punctuation">.</span>mounted<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">hook</span> <span class="token operator">=></span> <span class="token function">hook</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>renderContext<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            beforeUpdate <span class="token operator">&amp;&amp;</span> <span class="token function">beforeUpdate</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>renderContext<span class="token punctuation">)</span>
            <span class="token function">patch</span><span class="token punctuation">(</span>instance<span class="token punctuation">.</span>subTree<span class="token punctuation">,</span> subTree<span class="token punctuation">,</span> container<span class="token punctuation">,</span> anchor<span class="token punctuation">)</span>
            updated <span class="token operator">&amp;&amp;</span> <span class="token function">updated</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>renderContext<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        instance<span class="token punctuation">.</span>subTree <span class="token operator">=</span> subTree
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">scheduler</span><span class="token operator">:</span> queueJob
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></CodeGroupItem>
</CodeGroup>
<blockquote>
<p>å¯¹äºé™¤ mounted ä»¥å¤–çš„ç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°ï¼Œå…¶åŸç†åŒä¸Šã€‚</p>
</blockquote>
<h2 id="æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“" aria-hidden="true">#</a> æ€»ç»“</h2>
<CodeGroup>
<CodeGroupItem title="mountComponent">
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">mountComponent</span><span class="token punctuation">(</span><span class="token parameter">vnode<span class="token punctuation">,</span> container<span class="token punctuation">,</span> anchor</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> isFunctional <span class="token operator">=</span> <span class="token keyword">typeof</span> vnode<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'function'</span>
  <span class="token keyword">let</span> componentOptions <span class="token operator">=</span> vnode<span class="token punctuation">.</span>type
  <span class="token keyword">if</span> <span class="token punctuation">(</span>isFunctional<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    componentOptions <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">render</span><span class="token operator">:</span> vnode<span class="token punctuation">.</span>type<span class="token punctuation">,</span>
      <span class="token literal-property property">props</span><span class="token operator">:</span> vnode<span class="token punctuation">.</span>type<span class="token punctuation">.</span>props
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">let</span> <span class="token punctuation">{</span> render<span class="token punctuation">,</span> data<span class="token punctuation">,</span> setup<span class="token punctuation">,</span> beforeCreate<span class="token punctuation">,</span> created<span class="token punctuation">,</span> beforeMount<span class="token punctuation">,</span> mounted<span class="token punctuation">,</span> beforeUpdate<span class="token punctuation">,</span> updated<span class="token punctuation">,</span> <span class="token literal-property property">props</span><span class="token operator">:</span> propsOption <span class="token punctuation">}</span> <span class="token operator">=</span> componentOptions

  beforeCreate <span class="token operator">&amp;&amp;</span> <span class="token function">beforeCreate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token keyword">const</span> state <span class="token operator">=</span> data <span class="token operator">?</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">null</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>props<span class="token punctuation">,</span> attrs<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">resolveProps</span><span class="token punctuation">(</span>propsOption<span class="token punctuation">,</span> vnode<span class="token punctuation">.</span>props<span class="token punctuation">)</span>

  <span class="token keyword">const</span> slots <span class="token operator">=</span> vnode<span class="token punctuation">.</span>children <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token keyword">const</span> instance <span class="token operator">=</span> <span class="token punctuation">{</span>
    state<span class="token punctuation">,</span>
    <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token function">shallowReactive</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">isMounted</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token literal-property property">subTree</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    slots<span class="token punctuation">,</span>
    <span class="token literal-property property">mounted</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">emit</span><span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> <span class="token operator">...</span>payload</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> eventName <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">on</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>event<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> event<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
    <span class="token keyword">const</span> handler <span class="token operator">=</span> instance<span class="token punctuation">.</span>props<span class="token punctuation">[</span>eventName<span class="token punctuation">]</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>handler<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">handler</span><span class="token punctuation">(</span><span class="token operator">...</span>payload<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'äº‹ä»¶ä¸å­˜åœ¨'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// setup</span>
  <span class="token keyword">let</span> setupState <span class="token operator">=</span> <span class="token keyword">null</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>setup<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> setupContext <span class="token operator">=</span> <span class="token punctuation">{</span> attrs<span class="token punctuation">,</span> emit<span class="token punctuation">,</span> slots <span class="token punctuation">}</span>
    <span class="token keyword">const</span> prevInstance <span class="token operator">=</span> <span class="token function">setCurrentInstance</span><span class="token punctuation">(</span>instance<span class="token punctuation">)</span>
    <span class="token keyword">const</span> setupResult <span class="token operator">=</span> <span class="token function">setup</span><span class="token punctuation">(</span><span class="token function">shallowReadonly</span><span class="token punctuation">(</span>instance<span class="token punctuation">.</span>props<span class="token punctuation">)</span><span class="token punctuation">,</span> setupContext<span class="token punctuation">)</span>
    <span class="token function">setCurrentInstance</span><span class="token punctuation">(</span>prevInstance<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> setupResult <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>render<span class="token punctuation">)</span> console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'setup å‡½æ•°è¿”å›æ¸²æŸ“å‡½æ•°ï¼Œrender é€‰é¡¹å°†è¢«å¿½ç•¥'</span><span class="token punctuation">)</span>
      render <span class="token operator">=</span> setupResult
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      setupState <span class="token operator">=</span> setupContext
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  vnode<span class="token punctuation">.</span>component <span class="token operator">=</span> instance

  <span class="token keyword">const</span> renderContext <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>instance<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token function">get</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> k<span class="token punctuation">,</span> r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span> state<span class="token punctuation">,</span> props<span class="token punctuation">,</span> slots <span class="token punctuation">}</span> <span class="token operator">=</span> t

      <span class="token keyword">if</span> <span class="token punctuation">(</span>k <span class="token operator">===</span> <span class="token string">'$slots'</span><span class="token punctuation">)</span> <span class="token keyword">return</span> slots

      <span class="token keyword">if</span> <span class="token punctuation">(</span>state <span class="token operator">&amp;&amp;</span> k <span class="token keyword">in</span> state<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> state<span class="token punctuation">[</span>k<span class="token punctuation">]</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>k <span class="token keyword">in</span> props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> props<span class="token punctuation">[</span>k<span class="token punctuation">]</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>setupState <span class="token operator">&amp;&amp;</span> k <span class="token keyword">in</span> setupState<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> setupState<span class="token punctuation">[</span>k<span class="token punctuation">]</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'ä¸å­˜åœ¨'</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">set</span> <span class="token punctuation">(</span>t<span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">,</span> r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span> state<span class="token punctuation">,</span> props <span class="token punctuation">}</span> <span class="token operator">=</span> t
      <span class="token keyword">if</span> <span class="token punctuation">(</span>state <span class="token operator">&amp;&amp;</span> k <span class="token keyword">in</span> state<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        state<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> v
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>k <span class="token keyword">in</span> props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        props<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> v
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>setupState <span class="token operator">&amp;&amp;</span> k <span class="token keyword">in</span> setupState<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        setupState<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> v
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'ä¸å­˜åœ¨'</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token comment">// created</span>
  created <span class="token operator">&amp;&amp;</span> <span class="token function">created</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>renderContext<span class="token punctuation">)</span>


  <span class="token function">effect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> subTree <span class="token operator">=</span> <span class="token function">render</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>renderContext<span class="token punctuation">,</span> renderContext<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>instance<span class="token punctuation">.</span>isMounted<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      beforeMount <span class="token operator">&amp;&amp;</span> <span class="token function">beforeMount</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>renderContext<span class="token punctuation">)</span>
      <span class="token function">patch</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> subTree<span class="token punctuation">,</span> container<span class="token punctuation">,</span> anchor<span class="token punctuation">)</span>
      instance<span class="token punctuation">.</span>isMounted <span class="token operator">=</span> <span class="token boolean">true</span>
      mounted <span class="token operator">&amp;&amp;</span> <span class="token function">mounted</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>renderContext<span class="token punctuation">)</span>
      instance<span class="token punctuation">.</span>mounted <span class="token operator">&amp;&amp;</span> instance<span class="token punctuation">.</span>mounted<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">hook</span> <span class="token operator">=></span> <span class="token function">hook</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>renderContext<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      beforeUpdate <span class="token operator">&amp;&amp;</span> <span class="token function">beforeUpdate</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>renderContext<span class="token punctuation">)</span>
      <span class="token function">patch</span><span class="token punctuation">(</span>instance<span class="token punctuation">.</span>subTree<span class="token punctuation">,</span> subTree<span class="token punctuation">,</span> container<span class="token punctuation">,</span> anchor<span class="token punctuation">)</span>
      updated <span class="token operator">&amp;&amp;</span> <span class="token function">updated</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>renderContext<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    instance<span class="token punctuation">.</span>subTree <span class="token operator">=</span> subTree
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">scheduler</span><span class="token operator">:</span> queueJob
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></CodeGroupItem>
<CodeGroupItem title="resolveProps">
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">resolveProps</span><span class="token punctuation">(</span><span class="token parameter">options<span class="token punctuation">,</span> propsData</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> props <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token keyword">const</span> attrs <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> propsData<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>options <span class="token operator">&amp;&amp;</span> key <span class="token keyword">in</span> options<span class="token punctuation">)</span> <span class="token operator">||</span> key<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">'on'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      props<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> propsData<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      attrs<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> propsData<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token punctuation">[</span> props<span class="token punctuation">,</span> attrs <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></CodeGroupItem>
<CodeGroupItem title="setCurrentInstance">
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code><span class="token keyword">let</span> currentInstance <span class="token operator">=</span> <span class="token keyword">null</span>
<span class="token keyword">function</span> <span class="token function">setCurrentInstance</span><span class="token punctuation">(</span><span class="token parameter">instance</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> prev <span class="token operator">=</span> currentInstance
  currentInstance <span class="token operator">=</span> instance
  <span class="token keyword">return</span> prev
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></CodeGroupItem>
<CodeGroupItem title="onMounted">
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">onMounted</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>currentInstance<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    currentInstance<span class="token punctuation">.</span>mounted<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></CodeGroupItem>
</CodeGroup>
</div></template>
